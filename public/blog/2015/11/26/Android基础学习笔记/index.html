
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Android基础学习笔记 - AnnPeter's Blog</title>
	<meta name="author" content="AnnPeter">

	
	<meta name="description" content="Android基础学习笔记">
	<meta name="keywords" content="Android,Android基础,博客,AnnPeter's Blog">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="" rel="alternate" title="AnnPeter's Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

	
	<link href="/stylesheets/pygments.css">

	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

	<script src="/javascripts/jquery-1.10.2.js"></script>
	<script src="/javascripts/jquery-migrate-1.2.1.js"></script>


	
	

</head>


<body>
	<header id="header" class="inner"><h1><a href="/">AnnPeter's Blog</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:www.annpeter.cn">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
		<a class="github" href="https://github.com/annpeter" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:www.annpeter.cn">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post"><div id="rightArticle">
	
		<h2 class="title">Android基础学习笔记</h2>
		<div class="entry-content">
			<a name="ADB"></a>
<h2>ADB</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>$ adb <span class="k">start</span><span class="p">-</span>server :启动adb进程
</span><span class='line'>$ adb kill<span class="p">-</span>server
</span><span class='line'>$ adb install <span class="sr">/home/</span>annpeter/test.apk
</span><span class='line'>$ adb uninstall 应用包名
</span><span class='line'>$ adb devices :列出已经启动的Android设备
</span><span class='line'>$ adb <span class="k">shell</span> :进入安卓命令行
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<a name="L..............."></a>
<h2>电话拨号器</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="sr">//</span>需要添加权限:
</span><span class='line'><span class="p">&lt;</span>uses<span class="p">-</span>permission android:name<span class="p">=</span><span class="s2">&quot;android.permission.CALL_PHONE&quot;</span>/<span class="p">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">String</span> <span class="n">phone_num</span> <span class="o">=</span> <span class="o">((</span><span class="n">EditText</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">phone_num</span><span class="o">)).</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">();</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_CALL</span><span class="o">);</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;tel:&quot;</span><span class="o">+</span><span class="n">phone_num</span><span class="o">));</span>
</span><span class='line'><span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............."></a>
<h2>短息发送器</h2>

<p><strong>Android下查看手机一些信息：</strong>  *#*#4636#*#* 可以查看到IP地址，短息中心号码等信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">String</span> <span class="n">phone_num</span> <span class="o">=</span> <span class="o">((</span><span class="n">EditText</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">phone_num</span><span class="o">)).</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
</span><span class='line'><span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="o">((</span><span class="n">EditText</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">content</span><span class="o">)).</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="n">SmsManager</span> <span class="n">sm</span> <span class="o">=</span> <span class="n">SmsManager</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span>
</span><span class='line'><span class="n">sm</span><span class="o">.</span><span class="na">sendTextMessage</span><span class="o">(</span><span class="n">phone_num</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">content</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L............"></a>
<h2>布局介绍</h2>

<a name="LinearLayout"></a>
<h3>LinearLayout</h3>

<ul>
<li>有一个布局方向，水平或者竖直  &nbsp;<strong>orientation</strong></li>
<li>在竖直布局下，左对齐、右对齐，水平居中生效  <strong>Layout_gravity</strong></li>
<li>在水平布局下，顶部对齐，底部对齐，竖直居中生效 <strong>Layout_gravity</strong></li>
<li>权重：按比例分配屏幕剩余的款对或者高度 &nbsp;<strong>Layout_weight</strong></li>
</ul>


<a name="RelativeLayout"></a>
<h3>RelativeLayout</h3>

<ul>
<li>组建默认位置都是左上角，组建之间可以重叠</li>
<li>可以相对于父元素上下左右对齐，相对于父元素，水平居中、竖直居中、水平竖直居中    &nbsp;<strong>layout_alignParent&lowast;&lowast;</strong></li>
<li><p>可以相对于其他组建上下左右对齐
&nbsp;<strong>layout_align&lowast;&lowast;</strong></p></li>
<li><p>可以布局于其它组建的上方、下方、左方、右方 &nbsp;<strong>layout_to&lowast;&lowast;Of</strong></p></li>
</ul>


<a name="FrameLayout"></a>
<h3>FrameLayout</h3>

<ul>
<li>组建默认位置都是左上角，组建之间可以重叠</li>
<li>可以设置上下左右对齐，水平竖直居中，设置方式和LinearLayout同</li>
</ul>


<a name="TableLayout"></a>
<h3>TableLayout</h3>

<ul>
<li>每有一个TableRow表示一行，该子节点打每一个子节点都表示一列</li>
<li>TabLayout的一级子节点默认宽都是match_parent</li>
<li>TableRow的子节点默认高度都是包裹wrap_content</li>
<li>TableLayout中制定拉伸列strechColumns，多个用逗号隔开</li>
<li>layout_column指定当前单元格列的位置</li>
<li>layout_span指定当前单元格占几列</li>
</ul>


<a name="AbsoLutelayout"></a>
<h3>AbsoLutelayout</h3>

<ul>
<li>基本不会用到</li>
</ul>


<a name="Android........."></a>
<h2>Android的存储</h2>

<a name="L.................."></a>
<h3>内部存储空间</h3>

<ul>
<li>RAM内存：运行内存，相当于电脑多内存</li>
<li>ROM内存：存储内存，相当于电脑多硬盘</li>
</ul>


<a name="L.................."></a>
<h3>外部存储空间</h3>

<ul>
<li>SD卡：相当于电脑的移动硬盘</li>
</ul>


<a name="Android..............."></a>
<h3>Android写文件操作</h3>

<p>/data/data/* &nbsp;下文件操作不需要Android文件读写权限，该路径下的访问权限只有本应用程序有，其它程序不可访问</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//File file = new File(&quot;/data/data/com.example.neibucuncu/name.txt&quot;);</span>
</span><span class='line'><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">getFilesDir</span><span class="o">(),</span> <span class="s">&quot;name.txt&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'><span class="n">fos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">editText</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">getBytes</span><span class="o">());</span>
</span><span class='line'><span class="n">fos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Android..............."></a>
<h3>Android读文件操作</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//File file = new File(&quot;/data/data/com.example.neibucuncu/name.txt&quot;);</span>
</span><span class='line'><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">getFilesDir</span><span class="o">(),</span> <span class="s">&quot;name.txt&quot;</span><span class="o">);</span>
</span><span class='line'><span class="k">if</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">()){</span>
</span><span class='line'>  <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>      <span class="c1">//把字节流转为字符流</span>
</span><span class='line'>      <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nf">InputStreamReader</span><span class="o">(</span><span class="n">fis</span><span class="o">));</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
</span><span class='line'>      <span class="k">while</span><span class="o">(</span> <span class="o">(</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
</span><span class='line'>          <span class="n">str</span> <span class="o">+=</span> <span class="n">line</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//当我把间隔符号换成$$, split不能分开。。。</span>
</span><span class='line'>      <span class="n">String</span><span class="o">[]</span> <span class="n">strArr</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;##&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="o">((</span><span class="n">EditText</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">name</span><span class="o">)).</span><span class="na">setText</span><span class="o">(</span><span class="n">strArr</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</span><span class='line'>      <span class="o">((</span><span class="n">EditText</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">passwd</span><span class="o">)).</span><span class="na">setText</span><span class="o">(</span><span class="n">strArr</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L............API........................"></a>
<h3>使用路径API获取内部存储路径</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">File</span> <span class="nf">getFilesDir</span><span class="o">();</span>        <span class="c1">//该路径只允许本程序访问，位于/data/data/应用包名/files下</span>
</span><span class='line'><span class="n">File</span> <span class="nf">getCacheDir</span><span class="o">();</span>     <span class="c1">//和上面一样只是这个API获取出来位于/data/data/应用包名/Cache下</span>
</span><span class='line'>                      <span class="c1">//当系统内部存储不足时，cache中的文件可能会被删除，可以设置该文件</span>
</span><span class='line'>                      <span class="c1">//中文件的阀值</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Android.................."></a>
<h3>Android外部存储空间</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageState</span><span class="o">();</span>  <span class="c1">//MEDIA_UNKNOWN:不能识别SD卡</span>
</span><span class='line'>                                      <span class="c1">//MEDIA_REMOVED:没有SD卡</span>
</span><span class='line'>                                      <span class="c1">//MEDIA_UNMOUNTED:SD卡存在但是没有挂载</span>
</span><span class='line'>                                      <span class="c1">//MEDIA_CHECKING:SD卡正在准备</span>
</span><span class='line'>                                      <span class="c1">//MEDIA_MOUNTED:SD卡已经挂载可用</span>
</span><span class='line'><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">();</span> <span class="c1">//获取SD卡路径</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//获取SD卡剩余空间－－查看Android源码</span>
</span><span class='line'><span class="n">File</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">();</span>
</span><span class='line'><span class="n">StatFs</span> <span class="n">stat</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StatFs</span><span class="o">(</span><span class="n">path</span><span class="o">.</span><span class="na">getPath</span><span class="o">());</span>
</span><span class='line'><span class="kt">long</span> <span class="n">blockSize</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="na">getBlockSize</span><span class="o">();</span>
</span><span class='line'><span class="kt">long</span> <span class="n">totalBlocks</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="na">getBlockCount</span><span class="o">();</span>
</span><span class='line'><span class="kt">long</span> <span class="n">avialableBlocks</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="na">getAvailableBlocks</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="n">String</span> <span class="n">size</span> <span class="o">=</span> <span class="n">Formatter</span><span class="o">.</span><span class="na">formatFileSize</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">avialableBlocks</span> <span class="o">*</span> <span class="n">blockSize</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..........................."></a>
<h3>获取当前系统的等级</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span>   <span class="c1">//当前系统等级</span>
</span><span class='line'><span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.**</span>   <span class="c1">//安卓SDK等级代号</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L................................."></a>
<h3>创建特定访问权限的文件</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//在内部存储中创建文件，默认路径为 /data/data/应用包名/files</span>
</span><span class='line'><span class="c1">//MODE_PRIVATE本程序可以访问</span>
</span><span class='line'><span class="c1">//MODE_WORLD_WRITEABLE全局可写</span>
</span><span class='line'><span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="n">openFileOutput</span><span class="o">(</span><span class="s">&quot;name.txt&quot;</span><span class="o">,</span> <span class="n">MODE_</span><span class="o">**);</span>
</span><span class='line'><span class="n">fos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;AnnPeter&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
</span><span class='line'><span class="n">fos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="SharedPreference"></a>
<h3>SharedPreference</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//路径为 /data/data/应用包名/shared_prefs/info.xml</span>
</span><span class='line'><span class="n">SharedPreference</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">getSharedPreference</span><span class="o">(</span><span class="s">&quot;info&quot;</span><span class="o">,</span> <span class="n">MODE_PRIVATE</span><span class="o">);</span>
</span><span class='line'><span class="c1">//拿到sp的编辑器</span>
</span><span class='line'><span class="n">Editor</span> <span class="n">ed</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="na">edit</span><span class="o">();</span>
</span><span class='line'><span class="c1">//以键值对方式写入</span>
</span><span class='line'><span class="n">ed</span><span class="o">.</span><span class="na">putString</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span><span class="s">&quot;AnnPeter&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">ed</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//读取</span>
</span><span class='line'><span class="n">sp</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;defaultString&quot;</span><span class="o">);</span>   <span class="c1">//第二个参数为，获取失败时的字符串</span>
</span></code></pre></td></tr></table></div></figure>


<a name="XML............"></a>
<h2>XML短信备份</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//模拟创建短信内容</span>
</span><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="n">smsList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;();</span>
</span><span class='line'><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
</span><span class='line'>  <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Message</span><span class="o">(</span><span class="s">&quot;AnnPeter is &quot;</span><span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="s">&quot;2015-01-&quot;</span><span class="o">+</span><span class="n">i</span><span class="o">,</span> <span class="s">&quot;1&quot;</span><span class="o">,</span> <span class="s">&quot;123456&quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>  <span class="n">smsList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//用StringBuffer方式拼接XML，下面还提供了XML序列化器的方式</span>
</span><span class='line'><span class="n">StringBuffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuffer</span><span class="o">();</span>
</span><span class='line'><span class="c1">//XML头的信息的顺序必须如此先version再encoding再standalone</span>
</span><span class='line'><span class="c1">//XML下面子能有一个子元素</span>
</span><span class='line'><span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;utf-8&#39; standalone=&#39;yes&#39; ?&gt;\n&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&lt;message&gt;\n&quot;</span><span class="o">);</span>
</span><span class='line'><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">smsList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
</span><span class='line'>  <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="n">smsList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>  <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&lt;sms&gt;\n&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;\t&lt;body&gt;&quot;</span><span class="o">+</span><span class="n">message</span><span class="o">.</span><span class="na">getBody</span><span class="o">()+</span><span class="s">&quot;&lt;/body&gt;\n&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;\t&lt;data&gt;&quot;</span><span class="o">+</span><span class="n">message</span><span class="o">.</span><span class="na">getData</span><span class="o">()+</span><span class="s">&quot;&lt;/data&gt;\n&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;\t&lt;type&gt;&quot;</span><span class="o">+</span><span class="n">message</span><span class="o">.</span><span class="na">getType</span><span class="o">()+</span><span class="s">&quot;&lt;/type&gt;\n&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;\t&lt;adress&gt;&quot;</span><span class="o">+</span><span class="n">message</span><span class="o">.</span><span class="na">getAdress</span><span class="o">()+</span><span class="s">&quot;&lt;/adress&gt;\n&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&lt;/sms&gt;\n&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;&lt;/message&gt;\n&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">();</span>
</span><span class='line'><span class="c1">//Android目录不存在不会创建目录，但是文件不存在会创建文件</span>
</span><span class='line'><span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="s">&quot;/message.xml&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>  <span class="n">fos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">getBytes</span><span class="o">());</span>
</span><span class='line'>  <span class="n">fos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="XML..............strong........................................................................strong."></a>
<h3>XML序列化器 <strong>用序列化生成器可以自动转义掉节点内部非法的字符</strong></h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="n">smsList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;();</span>
</span><span class='line'><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
</span><span class='line'>  <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Message</span><span class="o">(</span><span class="s">&quot;AnnPeter is &quot;</span><span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="s">&quot;2015-01-&quot;</span><span class="o">+</span><span class="n">i</span><span class="o">,</span> <span class="s">&quot;1&quot;</span><span class="o">,</span> <span class="s">&quot;123456&quot;</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>  <span class="n">smsList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">//拿到序列化生成器对象</span>
</span><span class='line'><span class="n">XmlSerializer</span> <span class="n">xmlSerializer</span> <span class="o">=</span> <span class="n">Xml</span><span class="o">.</span><span class="na">newSerializer</span><span class="o">();</span>
</span><span class='line'><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">().</span><span class="na">getPath</span><span class="o">()+</span><span class="s">&quot;/message2.xml&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>  <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">setOutput</span><span class="o">(</span><span class="n">fos</span><span class="o">,</span> <span class="s">&quot;utf-8&quot;</span><span class="o">);</span><span class="c1">//这里的utf-8指的是用什么编码保存该XML文件</span>
</span><span class='line'>  <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">startDocument</span><span class="o">(</span><span class="s">&quot;utf-8&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span><span class="c1">//这里的utf-8指的是XML文件头上的encoding</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">startTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;message&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">smsList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">startTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;sms&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">startTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;body&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="n">smsList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getBody</span><span class="o">());</span>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">endTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;body&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">startTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;data&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="n">smsList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getData</span><span class="o">());</span>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">endTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;data&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">startTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;adress&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="n">smsList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getAdress</span><span class="o">());</span>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">endTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;adress&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">startTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;type&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="n">smsList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getType</span><span class="o">());</span>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">endTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;type&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">endTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;sms&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">endTag</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">&quot;message&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">xmlSerializer</span><span class="o">.</span><span class="na">endDocument</span><span class="o">();</span><span class="c1">//告诉序列化生成器，XML生成完毕</span>
</span><span class='line'><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// TODO Auto-generated catch block</span>
</span><span class='line'>  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="PULL......XML......"></a>
<h3>PULL解析XML文件</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//获取src文件夹下的资源文件</span>
</span><span class='line'><span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">getClassLoader</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&quot;message.xml&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//拿到PULL解析器对象</span>
</span><span class='line'><span class="n">XmlPullParser</span> <span class="n">xpp</span> <span class="o">=</span> <span class="n">Xml</span><span class="o">.</span><span class="na">newPullParser</span><span class="o">();</span>
</span><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">xpp</span><span class="o">.</span><span class="na">setInput</span><span class="o">(</span><span class="n">is</span><span class="o">,</span> <span class="s">&quot;utf-8&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//获取当前节点的事件类型，通过对事件类型的判断，我们可以知道当前节点是什么节点，从而确定应该执行什么样的操作</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">getEventType</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="k">while</span><span class="o">(</span><span class="n">type</span> <span class="o">!=</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_DOCUMENT</span><span class="o">){</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">START_TAG</span><span class="o">:</span>
</span><span class='line'>              <span class="k">if</span><span class="o">(</span><span class="s">&quot;message&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
</span><span class='line'>                  <span class="n">messageList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;();</span>
</span><span class='line'>              <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="s">&quot;sms&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">xpp</span><span class="o">.</span><span class="na">getName</span><span class="o">())){</span>
</span><span class='line'>                  <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Message</span><span class="o">();</span>
</span><span class='line'>              <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="s">&quot;body&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
</span><span class='line'>                  <span class="n">message</span><span class="o">.</span><span class="na">setBody</span><span class="o">(</span><span class="n">xpp</span><span class="o">.</span><span class="na">nextText</span><span class="o">());</span>
</span><span class='line'>              <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="s">&quot;adress&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
</span><span class='line'>                  <span class="n">message</span><span class="o">.</span><span class="na">setAdress</span><span class="o">(</span><span class="n">xpp</span><span class="o">.</span><span class="na">nextText</span><span class="o">());</span>
</span><span class='line'>              <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="s">&quot;type&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
</span><span class='line'>                  <span class="n">message</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="n">xpp</span><span class="o">.</span><span class="na">nextText</span><span class="o">());</span>
</span><span class='line'>              <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="s">&quot;data&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
</span><span class='line'>                  <span class="n">message</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">xpp</span><span class="o">.</span><span class="na">nextText</span><span class="o">());</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>              <span class="k">break</span><span class="o">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="n">XmlPullParser</span><span class="o">.</span><span class="na">END_TAG</span><span class="o">:</span>
</span><span class='line'>              <span class="k">if</span><span class="o">(</span><span class="s">&quot;sms&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
</span><span class='line'>                  <span class="n">messageList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>              <span class="k">break</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">type</span> <span class="o">=</span> <span class="n">xpp</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="o">(</span><span class="n">Message</span> <span class="n">ms</span> <span class="o">:</span> <span class="n">messageList</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ms</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L......"></a>
<h2>测试</h2>

<a name="L..............."></a>
<h3>按岗位划分</h3>

<ul>
<li>黒盒测试：测试逻辑业务</li>
<li>白盒测试：测试逻辑方法</li>
</ul>


<a name="L.................."></a>
<h3>按测试粒度分</h3>

<ul>
<li>方法测试： function test</li>
<li>单元测试： unit test</li>
<li>集成测试： integration test</li>
<li>系统测试： system test</li>
</ul>


<a name="L..........................."></a>
<h3>按测试的暴力程度分</h3>

<ul>
<li>冒烟测试： smock test</li>
<li>压力测试： pressure test</li>
</ul>


<a name="L.............junit"></a>
<h3>单元测试 junit</h3>

<ul>
<li>测试类继承AndroidTestCase</li>
<li>在AndroidManifest.xml文件中指定指令集</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>//该条配置和application同级
</span><span class='line'><span class="nt">&lt;instrumentation</span>
</span><span class='line'>      <span class="na">android:name=</span><span class="s">&quot;android.test.InstrumentationTestRunner&quot;</span>
</span><span class='line'>      <span class="err">//指定该测试框架要测试哪一个项目</span>
</span><span class='line'>      <span class="na">android:targetPackage=</span><span class="s">&quot;com.example.junit&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/instrumentation&gt;</span>
</span><span class='line'>
</span><span class='line'>//该条配置和activity同级
</span><span class='line'><span class="nt">&lt;uses-library</span> <span class="na">android:name=</span><span class="s">&quot;android.test.runner&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L......................................................"></a>
<h3>断言：用来检测实际值与期望值是否一样</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">assertEquals</span><span class="o">(</span><span class="n">arg1</span><span class="o">,</span> <span class="n">arg2</span><span class="o">);</span>  <span class="c1">//arg1表示期望值，arg2表示实际值</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L.........SQLite"></a>
<h2>数据库SQLite</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//构建数据库管理类，继承自SQLiteOpenHelper，实现父类的抽象方法</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyOpenHelper</span>  <span class="kd">extends</span> <span class="n">SQLiteOpenHelper</span><span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">MyOpenHelper</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">CursorFactory</span> <span class="n">factory</span><span class="o">,</span> <span class="kt">int</span> <span class="n">version</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">factory</span><span class="o">,</span> <span class="n">version</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="s">&quot;create table person(_id integer primary key autoincrement,</span>
</span><span class='line'><span class="s">                      name char(20), salary char(20), phone char(11));&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onUpgrade</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldVersion</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newVersion</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//getContext():junit测试框架获取虚拟上下文， 如果要使mHelper称为全局变量，则他不能在定义时初始化，</span>
</span><span class='line'><span class="c1">//全局变量的初始化时测试框架还没有初始化完毕，虚拟上下文对象也没有初始化成功，getContext()</span>
</span><span class='line'><span class="c1">//不能获取到实际对象，对于全局变量的初始化，可以重写父类的setUp()方法来初始化。</span>
</span><span class='line'><span class="c1">//setUp()在测试框架初始化完成后调用，在测试方法调用前调用，还有一个父类的tearDown()方法，</span>
</span><span class='line'><span class="c1">//在测试方法调用后调用，可以用于测试完成后的操作</span>
</span><span class='line'>
</span><span class='line'><span class="n">MyOpenHelper</span> <span class="n">mHelper</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MyOpenHelper</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="s">&quot;people.db&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'><span class="c1">//如果数据库不存在，先创建数据库，再获取可读可写数据库对象；如果数据库存在，直接打开</span>
</span><span class='line'><span class="n">SQLiteDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="n">mHelper</span><span class="o">.</span><span class="na">getWritableDatabase</span><span class="o">();</span>
</span><span class='line'><span class="c1">//如果存储空间（内部存储，所以备份文件一般不采用数据库保存）满了，那么返回只读数据库对象</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//执行SQL语句－－用获取到的db对象，调用</span>
</span><span class='line'><span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">();</span><span class="n">方法即可</span><span class="o">,</span><span class="n">可用于数据库创建</span><span class="err">，</span><span class="n">表创建</span><span class="err">，</span><span class="n">增加</span><span class="err">、</span><span class="n">修改</span><span class="err">、</span><span class="n">删除</span><span class="err">；</span><span class="n">db</span><span class="o">.</span><span class="na">rawQuery</span><span class="o">();</span><span class="n">用于查询</span>
</span><span class='line'><span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="s">&quot;insert into person(name, phone, salary) values(?, ?, ?)&quot;</span><span class="o">,</span>
</span><span class='line'>          <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span><span class="s">&quot;AnnPeter&quot;</span><span class="o">,</span> <span class="s">&quot;12312341234&quot;</span><span class="o">,</span> <span class="s">&quot;60000&quot;</span><span class="o">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Curosr中，通过列名获取值</span>
</span><span class='line'><span class="k">while</span><span class="o">(</span><span class="n">curosr</span><span class="o">.</span><span class="na">moveToNext</span><span class="o">()){</span><span class="c1">//cursor初始化指向－1条记录</span>
</span><span class='line'>  <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndex</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">db</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>  <span class="c1">//关闭数据库连接</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//使用API来增删改查</span>
</span><span class='line'><span class="c1">//插入，把待插入的数据封装至ContentValues对象中</span>
</span><span class='line'><span class="c1">//ContentValue使用完后最好clear()一下，否则可能下次使用时，插入上次相同的记录会出现两个</span>
</span><span class='line'><span class="n">ContentValues</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ContentValues</span><span class="o">();</span>
</span><span class='line'><span class="n">values</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;AnnPeter&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">values</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;phone&quot;</span><span class="o">,</span> <span class="s">&quot;12312341234&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">db</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">&quot;person&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="SQLite......"></a>
<h3>SQLite事务</h3>

<blockquote><p>保证所有SQL语句要么一起成功，要么一起失败。</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">try</span><span class="o">{</span>
</span><span class='line'>  <span class="n">db</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//数据库操作</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//设置 表明事务执行成功</span>
</span><span class='line'>  <span class="n">db</span><span class="o">.</span><span class="na">setTransactionSuccessful</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span><span class="n">finallly</span><span class="o">{</span>
</span><span class='line'>  <span class="c1">//关闭事务，同时提交, 如果执行此代码时，已经表明事务执行成功，则此次SQL语句生效，反之自动执行事务回滚</span>
</span><span class='line'>  <span class="n">db</span><span class="o">.</span><span class="na">endTransation</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="ListView"></a>
<h2>ListView</h2>

<p><strong>当ListView中有Button，ImageButton， CheckBox等会强制获取焦点的View，此时，ListView的Item无法获取焦点，从而无法被点击。－－－－解决方法：给Item的根布局增加一下属性：android:descendantFocusability=&ldquo;blocksDescendants&rdquo;</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ListView</span> <span class="n">lv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">listView</span><span class="o">);</span>
</span><span class='line'><span class="n">lv</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="k">new</span> <span class="nf">MyAdapter</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">class</span> <span class="nc">MyAdapter</span> <span class="kd">extends</span> <span class="n">BaseAdapter</span><span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//系统调用，用来获知集合中有多少条元素</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// TODO Auto-generated method stub</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">smsList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//由系统调用，获取一个view对象，作为ListView的条目</span>
</span><span class='line'>  <span class="c1">//position:本次getView方法调用所返回的View对象，在ListView中处于第几个条目</span>
</span><span class='line'>  <span class="c1">//ListView在不可见时，可能会被系统销毁，以节约内存，取决于当前内存状态</span>
</span><span class='line'>  <span class="c1">//convertView缓存的是ListView的条目，缓存条目的个数是一屏能显示的最多条目的个数，</span>
</span><span class='line'>  <span class="c1">//所以在利用缓存的时候，条目里面显示的内容需要我们重新填充,之所以这么做是因为</span>
</span><span class='line'>  <span class="c1">//在使用布局文件填充view对象时，inflater方法比较耗费资源，容易内存溢出</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">TextView</span> <span class="n">tv</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TextView</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">);</span>
</span><span class='line'>      <span class="n">tv</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">smsList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">).</span><span class="na">getBody</span><span class="o">());</span>
</span><span class='line'>      <span class="n">tv</span><span class="o">.</span><span class="na">setTextSize</span><span class="o">(</span><span class="mi">18</span><span class="o">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">tv</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getItem</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getItemId</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............................View......"></a>
<h3>把布局文件填充成一个View对象</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//把布局文件填充成一个View对象</span>
</span><span class='line'><span class="c1">//方法一</span>
</span><span class='line'><span class="n">View</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">View</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">item</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//通过资源id查找组件，注意调用的是View对象的findViewById</span>
</span><span class='line'><span class="n">TextView</span> <span class="n">tv</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">v0</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
</span><span class='line'><span class="n">tv</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">smsList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">).</span><span class="na">getBody</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//方法二</span>
</span><span class='line'><span class="n">LayoutInflater</span> <span class="n">inflater</span> <span class="o">=</span> <span class="n">LayoutInflater</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">);</span>
</span><span class='line'><span class="n">View</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">item</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//方法三</span>
</span><span class='line'><span class="n">LayoutInflater</span> <span class="n">inflater2</span> <span class="o">=</span> <span class="o">(</span><span class="n">LayoutInflater</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">LAYOUT_INFLATER_SERVICE</span><span class="o">);</span>
</span><span class='line'><span class="n">View</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">item</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="ArrayAdapter"></a>
<h3>ArrayAdapter</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">String</span><span class="o">[]</span> <span class="n">strArr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span>
</span><span class='line'>  <span class="s">&quot;Ann&quot;</span><span class="o">,</span>
</span><span class='line'>  <span class="s">&quot;Peter&quot;</span><span class="o">,</span>
</span><span class='line'>  <span class="s">&quot;AnnPeter&quot;</span>
</span><span class='line'><span class="o">};</span>
</span><span class='line'>
</span><span class='line'><span class="n">ListView</span> <span class="n">lv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">listView</span><span class="o">);</span>
</span><span class='line'><span class="c1">//ArrayAdapter只能处理一种类型的数据</span>
</span><span class='line'><span class="n">ArrayAdapter</span> <span class="n">arrayAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">item</span><span class="o">,</span>
</span><span class='line'>                                      <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">textView</span><span class="o">,</span> <span class="n">strArr</span><span class="o">);</span>
</span><span class='line'><span class="n">lv</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">arrayAdapter</span><span class="o">);</span>
</span><span class='line'><span class="n">arrayAdapter</span><span class="o">.</span><span class="na">notifyDataSetChanged</span><span class="o">();</span> <span class="c1">//当strArr发生改变，动态刷新ListView</span>
</span></code></pre></td></tr></table></div></figure>


<a name="SimpleAdapter"></a>
<h3>SimpleAdapter</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ListView</span> <span class="n">lv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">listView</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;&gt;();</span>
</span><span class='line'>
</span><span class='line'><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'><span class="n">map1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;photo&quot;</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">img01</span><span class="o">);</span>
</span><span class='line'><span class="n">map1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Ann&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">data</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">map1</span><span class="o">);</span>
</span><span class='line'><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'><span class="n">map2</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;photo&quot;</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">img02</span><span class="o">);</span>
</span><span class='line'><span class="n">map2</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Peter&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">data</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">map2</span><span class="o">);</span>
</span><span class='line'><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'><span class="n">map3</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;photo&quot;</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">img03</span><span class="o">);</span>
</span><span class='line'><span class="n">map3</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;AnnPeter&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">data</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">map3</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">lv</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="k">new</span> <span class="nf">SimpleAdapter</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">data</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">item</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&quot;photo&quot;</span><span class="o">,</span> <span class="s">&quot;name&quot;</span><span class="o">},</span>
</span><span class='line'>                              <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">photo</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">name</span><span class="o">}));</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L........."></a>
<h2>对话框</h2>

<a name="Dialog"></a>
<h3>Dialog</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//构建一个AlertDialog的创建器</span>
</span><span class='line'><span class="n">AlertDialog</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;Title&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">abc_ab_share_pack_mtrl_alpha</span><span class="o">);</span>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="s">&quot;Content&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setPositiveButton</span><span class="o">(</span><span class="s">&quot;确定&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">DialogInterface</span> <span class="n">dialog</span><span class="o">,</span> <span class="kt">int</span> <span class="n">which</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;确定&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span><span class='line'>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setNegativeButton</span><span class="o">(</span><span class="s">&quot;取消&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">DialogInterface</span> <span class="n">dialog</span><span class="o">,</span> <span class="kt">int</span> <span class="n">which</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;取消&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//创建一个AlertDialog</span>
</span><span class='line'><span class="n">AlertDialog</span> <span class="n">dialog</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
</span><span class='line'><span class="n">dialog</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............."></a>
<h3>单选对话框</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//构建一个AlertDialog的创建器</span>
</span><span class='line'><span class="n">AlertDialog</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;Title&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">abc_ab_share_pack_mtrl_alpha</span><span class="o">);</span>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setSingleChoiceItems</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&quot;男&quot;</span><span class="o">,</span> <span class="s">&quot;女&quot;</span><span class="o">},</span> <span class="mi">0</span><span class="o">,</span> <span class="k">new</span> <span class="nf">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">DialogInterface</span> <span class="n">dialog</span><span class="o">,</span> <span class="kt">int</span> <span class="n">which</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;您选择的是&quot;</span><span class="o">+</span><span class="n">which</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>      <span class="n">dialog</span><span class="o">.</span><span class="na">dismiss</span><span class="o">();</span>  <span class="c1">//选择完后自动消失</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//创建一个AlertDialog</span>
</span><span class='line'><span class="n">AlertDialog</span> <span class="n">dialog</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
</span><span class='line'><span class="n">dialog</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............."></a>
<h3>多选对话框</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">AlertDialog</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;Title&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">abc_ab_share_pack_mtrl_alpha</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setMultiChoiceItems</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&quot;Ann&quot;</span><span class="o">,</span> <span class="s">&quot;Peter&quot;</span><span class="o">,</span> <span class="s">&quot;AnnPeter&quot;</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="kt">boolean</span><span class="o">[]{</span><span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">},</span>
</span><span class='line'>              <span class="k">new</span> <span class="nf">OnMultiChoiceClickListener</span><span class="o">(){</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">DialogInterface</span> <span class="n">dialog</span><span class="o">,</span> <span class="kt">int</span> <span class="n">which</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isChecked</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span><span class='line'>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setPositiveButton</span><span class="o">(</span><span class="s">&quot;确定&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">DialogInterface</span> <span class="n">dialog</span><span class="o">,</span> <span class="kt">int</span> <span class="n">which</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;确定&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span><span class='line'>
</span><span class='line'><span class="n">builder</span><span class="o">.</span><span class="na">setNegativeButton</span><span class="o">(</span><span class="s">&quot;取消&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">DialogInterface</span> <span class="n">dialog</span><span class="o">,</span> <span class="kt">int</span> <span class="n">which</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="s">&quot;取消&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//创建一个AlertDialog</span>
</span><span class='line'><span class="n">AlertDialog</span> <span class="n">dialog</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
</span><span class='line'><span class="n">dialog</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L............"></a>
<h2>网络编程</h2>

<a name="L..............."></a>
<h3>主线程阻塞</h3>

<ul>
<li>UI停止刷新，应用无法响应用户的操作</li>
<li>耗时操作不应该在主线程中执行</li>
<li>ANR（application not respond）异常，主线程阻塞时间过长就会抛出ANR异常</li>
<li>主线程又称为UI线程，因为只有在主线程中，才能刷新UI</li>
</ul>


<a name="L............"></a>
<h3>消息队列</h3>

<ul>
<li>主线程中有一个message queue（消息队列，用于保存消息） 和 looper（消息轮询器，用于检测消息队列是否有消息），在主线程创建时，系统自动创建这两个对象</li>
<li>Handler（消息处理器，处理消息 handleMessage()）， 一旦消息队列有消息，主线程就会自动调用handleMessage()方法处理，程序员在需要使用时手动创建</li>
<li>子线程使用Handler对象来向主线程的消息队列发送消息，触发主线程调用handleMessage刷新UI即可。</li>
</ul>


<a name="L....................."></a>
<h3>网络图片查看器</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">static</span> <span class="n">MyHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MyHandler</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//1.Android建议我们Handler最好是static的，以断开Handler和外部class的联系，让内部类和外部类不产生任何</span>
</span><span class='line'><span class="c1">//联系就是static class的目的，防止GC时因为handle有引用导致，activity不能被回收，循环泄漏</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//2.我们不需要在Activity中通过申明大量的static 变量来提供给handler 使用（这样的代码不仅难看而且设计很</span>
</span><span class='line'><span class="c1">//不合理）因为在MyHandler中设计一个mActivity的弱引用所以，我们可以调用mActivity的任何public函数和变量。</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//当Activity被finish()掉，这个Message持有一个对Handler的引用，Handler也会持有一个对于外部类</span>
</span><span class='line'><span class="c1">//（SampleActivity）的隐式引用，这些引用在Message被执行前将一直保持，这样会保证Activity的上下文不</span>
</span><span class='line'><span class="c1">//被垃圾回收机制回收，同时也会泄露应用程序的资源（views and resources）。</span>
</span><span class='line'>
</span><span class='line'><span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyHandler</span> <span class="kd">extends</span> <span class="n">Handler</span><span class="o">{</span>
</span><span class='line'>  <span class="n">WeakReference</span> <span class="n">mActivity</span> <span class="o">=</span>  <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">MyHandler</span><span class="o">(</span><span class="n">Activity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">mActivity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">Activity</span><span class="o">&gt;(</span><span class="n">activity</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Activity</span> <span class="n">activity</span> <span class="o">=</span> <span class="o">(</span><span class="n">Activity</span><span class="o">)</span> <span class="n">mActivity</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span><span class='line'>      <span class="c1">//处理消息时，要知道是成功的消息还是失败的消息</span>
</span><span class='line'>      <span class="k">switch</span> <span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">what</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>          <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="o">(</span><span class="n">Bitmap</span><span class="o">)</span> <span class="n">msg</span><span class="o">.</span><span class="na">obj</span><span class="o">;</span>
</span><span class='line'>          <span class="n">ImageView</span> <span class="n">iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">activity</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">imageView1</span><span class="o">);</span>
</span><span class='line'>          <span class="n">iv</span><span class="o">.</span><span class="na">setImageBitmap</span><span class="o">(</span><span class="n">bitmap</span><span class="o">);</span>
</span><span class='line'>          <span class="k">break</span><span class="o">;</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>          <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="s">&quot;请求失败&quot;</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>          <span class="k">break</span><span class="o">;</span>
</span><span class='line'>      <span class="k">default</span><span class="o">:</span>
</span><span class='line'>          <span class="k">break</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//如果有缓存则从缓存中读取</span>
</span><span class='line'><span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">getCacheDir</span><span class="o">(),</span> <span class="s">&quot;img01.jpg&quot;</span><span class="o">);</span>
</span><span class='line'><span class="k">if</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">()){</span>
</span><span class='line'>  <span class="n">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeStream</span><span class="o">(</span><span class="n">fis</span><span class="o">);</span>
</span><span class='line'>  <span class="n">ImageView</span> <span class="n">iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">imageView1</span><span class="o">);</span>
</span><span class='line'>  <span class="n">iv</span><span class="o">.</span><span class="na">setImageBitmap</span><span class="o">(</span><span class="n">bitmap</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span><span class="k">else</span><span class="o">{</span>
</span><span class='line'>  <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">(){</span>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span><span class='line'>          <span class="c1">//下载图片</span>
</span><span class='line'>          <span class="c1">//1.确定网址</span>
</span><span class='line'>          <span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="s">&quot;http://10.0.2.2/imgs/img01.jpg&quot;</span><span class="o">;</span>
</span><span class='line'>          <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>              <span class="c1">//2.把网址封装成一个URL对象</span>
</span><span class='line'>              <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
</span><span class='line'>              <span class="c1">//3.获取客户端和服务端的连接，此时连接还没有建立</span>
</span><span class='line'>              <span class="n">HttpURLConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>              <span class="c1">//4.对连接进行初始化</span>
</span><span class='line'>              <span class="c1">//4.1设置请求方法，注意大写</span>
</span><span class='line'>              <span class="n">conn</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>
</span><span class='line'>              <span class="c1">//4.2设置连接超时</span>
</span><span class='line'>              <span class="n">conn</span><span class="o">.</span><span class="na">setConnectTimeout</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
</span><span class='line'>              <span class="c1">//4.3设置读取超时</span>
</span><span class='line'>              <span class="n">conn</span><span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>              <span class="c1">//5.发送请求，与服务器建立连接</span>
</span><span class='line'>              <span class="n">conn</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>              <span class="c1">//如果响应吗为200，表明请求成功，服务器返回数据流</span>
</span><span class='line'>              <span class="k">if</span><span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">()</span> <span class="o">==</span> <span class="mi">200</span><span class="o">){</span>
</span><span class='line'>                  <span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c1">//读取出流里的数据，并构造成位图对象</span>
</span><span class='line'>                  <span class="c1">//Bitmap bitmap = BitmapFactory.decodeStream(is);</span>
</span><span class='line'>
</span><span class='line'>                  <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">getCacheDir</span><span class="o">(),</span> <span class="s">&quot;img01.jpg&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>                  <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ByteArrayOutputStream</span><span class="o">();</span>
</span><span class='line'>                  <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
</span><span class='line'>
</span><span class='line'>                  <span class="k">while</span><span class="o">(</span><span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">){</span>
</span><span class='line'>                      <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">buffer</span><span class="o">);</span>
</span><span class='line'>                  <span class="o">}</span>
</span><span class='line'>                  <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
</span><span class='line'>                  <span class="n">baos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c1">//写入缓存</span>
</span><span class='line'>                  <span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>                  <span class="n">fos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</span><span class='line'>                  <span class="n">fos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c1">//BitmapFactory.decodeFile(pathName);用 BitmapFactory.decodeStream()</span>
</span><span class='line'>                  <span class="c1">//这个方法，会出现概率性的解析失败的异常</span>
</span><span class='line'>                  <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeByteArray</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c1">//Message最好不要自己new，使用Handler中的obtainMessage()获取，obtainMessage()</span>
</span><span class='line'>                  <span class="c1">//会先检查消息缓冲池中是否有消息， 如果有，返回一个无用消息, 这样可以节约内存</span>
</span><span class='line'>                  <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Message</span><span class="o">();</span>
</span><span class='line'>                  <span class="n">msg</span><span class="o">.</span><span class="na">obj</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">msg</span><span class="o">.</span><span class="na">what</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">handler</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
</span><span class='line'>              <span class="o">}</span><span class="k">else</span><span class="o">{</span>
</span><span class='line'>                  <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="na">obtainMessage</span><span class="o">();</span>
</span><span class='line'>                  <span class="n">msg</span><span class="o">.</span><span class="na">what</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>          <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'>  <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L...ListView.................."></a>
<h2>对ListView的进一步优化</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="n">ViewHolder</span> <span class="n">mHolder</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">NEWS</span> <span class="n">news</span> <span class="o">=</span> <span class="n">newsList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="o">(</span><span class="n">convertView</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
</span><span class='line'>      <span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">item</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">mHolder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ViewHolder</span><span class="o">();</span>
</span><span class='line'>      <span class="n">mHolder</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span>  <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
</span><span class='line'>      <span class="n">mHolder</span><span class="o">.</span><span class="na">body</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">body</span><span class="o">);</span>
</span><span class='line'>      <span class="n">mHolder</span><span class="o">.</span><span class="na">read</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">readNum</span><span class="o">);</span>
</span><span class='line'>      <span class="n">mHolder</span><span class="o">.</span><span class="na">img</span> <span class="o">=</span> <span class="o">(</span><span class="n">SmartImageView</span><span class="o">)</span><span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">item_img</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//以前只是通过convertView将ListView中的每个子条目缓存起来，</span>
</span><span class='line'>      <span class="c1">//现在通过封装一个ViewHolder对象，将每个字条目内部的对象全部缓存起来，</span>
</span><span class='line'>      <span class="c1">//提高了效率</span>
</span><span class='line'>      <span class="n">view</span><span class="o">.</span><span class="na">setTag</span><span class="o">(</span><span class="n">mHolder</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span><span class="k">else</span><span class="o">{</span>
</span><span class='line'>      <span class="n">view</span> <span class="o">=</span> <span class="n">convertView</span><span class="o">;</span>
</span><span class='line'>      <span class="n">mHolder</span> <span class="o">=</span> <span class="o">(</span><span class="n">ViewHolder</span><span class="o">)</span> <span class="n">convertView</span><span class="o">.</span><span class="na">getTag</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mHolder</span><span class="o">.</span><span class="na">img</span><span class="o">.</span><span class="na">setImageUrl</span><span class="o">(</span><span class="n">news</span><span class="o">.</span><span class="na">getInfoImgUrl</span><span class="o">());</span>
</span><span class='line'>  <span class="n">mHolder</span><span class="o">.</span><span class="na">title</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">news</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
</span><span class='line'>  <span class="n">mHolder</span><span class="o">.</span><span class="na">body</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">news</span><span class="o">.</span><span class="na">getBody</span><span class="o">());</span>
</span><span class='line'>  <span class="n">mHolder</span><span class="o">.</span><span class="na">read</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">news</span><span class="o">.</span><span class="na">getRead</span><span class="o">()+</span><span class="s">&quot;条阅读量&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">class</span> <span class="nc">ViewHolder</span><span class="o">{</span>
</span><span class='line'>  <span class="n">SmartImageView</span> <span class="n">img</span><span class="o">;</span>
</span><span class='line'>  <span class="n">TextView</span> <span class="n">title</span><span class="o">;</span>
</span><span class='line'>  <span class="n">TextView</span> <span class="n">body</span><span class="o">;</span>
</span><span class='line'>  <span class="n">TextView</span> <span class="n">read</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="GET...POST............"></a>
<h2>GET、POST提交数据</h2>

<ul>
<li>使用GET方式提交数据时，如果URL地址中包含中文，注意使用URLEncoder转换</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
</span><span class='line'><span class="n">HttpURLConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">setConnectTimeout</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//拼接出要提交的数据的字符串</span>
</span><span class='line'><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;name=&quot;</span> <span class="o">+</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="s">&quot;AnnPeter&quot;</span><span class="o">,</span> <span class="s">&quot;utf-8&quot;</span><span class="o">)+</span><span class="s">&quot;&amp;pass=&quot;</span><span class="o">+</span><span class="s">&quot;123&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//添加POST请求的两行属性</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">&quot;Content-Type&quot;</span><span class="o">,</span> <span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">&quot;Content-Length&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">text</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//设置RANGE属性，实现分块下载，多线程下载</span>
</span><span class='line'><span class="c1">//conn.setRequestProperty(&quot;RANGE&quot;, &quot;bytes=&quot;+startIndex+&quot;-&quot;+endIndex);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//设置打开输出流，默认关闭</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">setDoOutput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//拿到输出流</span>
</span><span class='line'><span class="n">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">()</span> <span class="o">==</span> <span class="mi">200</span><span class="o">){</span>
</span><span class='line'>  <span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Activity"></a>
<h2>Activity</h2>

<a name="Activity........."></a>
<h4>Activity的跳转</h4>

<ul>
<li>Android的每一个Activity都需要在AndridManifest.xml文件中注册</li>
<li>主界面需要在Activity中添加子节点</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>  <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/intent-filter&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>安卓可以有多个入口，只要将上面的节点添加到Acitity中，就会在安卓的桌面出现一个快捷图标， 每个Activity图标就是桌面快捷方式的图标</li>
<li>每个Activity都有自己的Label，没有Label的默认使用Application的Label</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//显示跳转，直接指定目标Activity的类名</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">();</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setClass</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">SecondActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//隐式跳转</span>
</span><span class='line'><span class="c1">//Intent.ACTION_CALL 打电话应用</span>
</span><span class='line'><span class="c1">//Intent.ACTION_VIEW 浏览器</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_CALL</span><span class="o">);</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;tel:110&quot;</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//显示跳转</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setClass</span><span class="o">(</span><span class="s">&quot;com.android.dialer&quot;</span><span class="o">,</span> <span class="s">&quot;com.android.dialer.DialtactsActivity&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">arg1</span><span class="o">,</span> <span class="n">arg2</span><span class="o">);</span> <span class="c1">//传递参数</span>
</span><span class='line'><span class="c1">//传递数据还可以把所有数据封装至一个Bundle对象中</span>
</span><span class='line'><span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Bundle</span><span class="o">();</span>
</span><span class='line'><span class="n">bundle</span><span class="o">.</span><span class="na">putString</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;AnnPeter&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">putExtras</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//隐式跳转</span>
</span><span class='line'><span class="c1">//指定一个activity可以隐式跳转，需要在AndroidManifest.xml，activity子节点下添加属性</span>
</span><span class='line'><span class="c1">//有动作的activity才可以跳转</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">action</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;cn.annpeter.Activity&quot;</span><span class="o">/&gt;</span> <span class="c1">//name随便写,即设置的是intent.setAction()</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">category</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>      <span class="c1">//&lt;data android:scheme=&quot;AnnPeter&quot; android:mimeType=&quot;text/username&quot;/&gt;</span>
</span><span class='line'>  <span class="o">&lt;/</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">&quot;cn.annpeter.Activity&quot;</span><span class="o">);</span>
</span><span class='line'><span class="c1">//Intent.CATEGORY_DEFAULT 等价于 &quot;android.intent.category.DEFAULT&quot;</span>
</span><span class='line'><span class="c1">//而且系统会默认添加category，所以当category设置为&quot;android.intent.category.DEFAULT&quot;时，</span>
</span><span class='line'><span class="c1">//下面一行代码可以不用写</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">addCategory</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">CATEGORY_DEFAULT</span><span class="o">);</span>
</span><span class='line'><span class="c1">//如果要传输data，AndroidManifest.xml文件中本activity的intent-filter必须有一个&lt;data /&gt;子节点</span>
</span><span class='line'><span class="c1">//当data类型为scheme时AnnPeter必须是匹配的才行</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;AnnPeter:要传输的内容&quot;</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//接收方接收Intent和参数</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">();</span>
</span><span class='line'><span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span> <span class="c1">//获取参数</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L........."></a>
<h4>总结：</h4>

<ul>
<li>想要实现隐式跳转，inter-filter的设置和在代码中调用时的条目必须一一匹配</li>
<li>一个activity可以设置多个inter-filter，要想成功跳转，只需完全匹配其中一个即可</li>
<li>一个inter-filter中可以有多个anction，data，只需匹配一组即可</li>
<li>data可以指定mimeType标记data的类型，方便其它调用者查看，或接收页面识别使用</li>
<li>如果data和mineType同时存在，则不能调用intent.setData()和intent.setType()，他们两个不能共存；而要使用intent.setDataAndType()</li>
<li>如果是启动同一个应用中的activity，则一般用显示意图，如果是启动不同应用中的activity则一般用隐式； 全部都使用隐式是可以的，但显示跳转查找activity的速度比隐式的快（隐式需要在系统中的所有APP中的AndroidManifest.xml中查找inter-filter）；全部用显示，如果系统中有多个浏览器，则不会弹出选框让用户选择，隐式跳转如果有多个同类应用（inter-filter中的action是一样的），则会弹出选框选择</li>
</ul>


<a name="Activity............"></a>
<h3>Activity生命周期</h3>

<ul>
<li>onCreate: activity被创建时调用</li>
<li>onStart: activity能被用户看见，但是没有获得焦点</li>
<li>onResume: activity获得焦点，此时activity称为前台activity</li>
<li>onPause: activity失去焦点，但是依然可见</li>
<li>onStop: activity不可见，此时Activity称为后台activity</li>
<li>onDestroy: activity被销毁</li>
</ul>


<p>当两个页面间使用startActivityForResult(intent, requestCode);那么在页面返回的时候自动调用回调函数protected void onActivityResult(int requestCode, int resultCode, Intent data);</p>

<p><img src="/upload/2015/OCT/11/imgs/1444540809.png" alt="Activity生命周期图" /></p>

<a name="L..............."></a>
<h3>内存不足时</h3>

<ul>
<li>内存不足时，系统会优先杀死后台activity所在的进程，都杀光了，如果内存还是不够用，那么就会杀死暂停状态的activity所在的进程，如果还是不够，有可能杀死前台进程</li>
<li>如果有多个后台进程，在选择杀死的目标的时候，采用最近最少使用的算法（LRU）</li>
</ul>


<a name="Activity............"></a>
<h3>Activity启动模式</h3>

<blockquote><p>在AndroidManifest.xml的activity子节点下设置android:launchMode
－standard 标准模式，默认
－singleTop 不能在本Activity启动本Activity
－singleTask 如果该activity没有启动过，则会启动并跳转至该activity，即该activity出现在栈顶，如果该activity已经启动过，但不在栈顶，那么再次启动时，会返回该activity，即把该activity上方所有activity全部销毁。(在任务栈中，永远只有一个该activity的实例)
－singleInstance 该activity启动时，会在一个新的任务栈中启动，并且只会启动一次，以后再次启动该activity，其实只是把该activity所有的任务栈移动至前台（非单例模式的activity如果在10个应用中启动，那么就会有10个该实例，单例模式的activity，<strong>内存</strong>中永远只有一个，10个应用启动单例模式的activity，都只是把该activity所在的任务栈移动至前台）</p></blockquote>

<a name="Android..............."></a>
<h2>Android横竖屏切换</h2>

<a name="L...................Ctrl.....F11...Ctrl...............Ctrl..."></a>
<h3>模拟器快捷键 Ctrl ＋ F11（Ctrl键必须是左Ctrl）</h3>

<ul>
<li>在进行横竖屏切换时，默认Activity会被销毁然后重建， 若不想重建可以在AndroidManifest.xml中的activity中加入 android:configChanges=&ldquo;orientation|keyboardHidden|screenSize&rdquo;</li>
<li>写死横竖屏

<blockquote><p>横屏：android:screenOrientation=&ldquo;landscape&rdquo;<br>
或者：setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE);<br>
<br>
竖屏：android:screenOrientation=&ldquo;portrait&rdquo;<br>
或者：setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);<br></p></blockquote></li>
</ul>


<a name="L......................................."></a>
<h2>广播接收者（四大组件之一）</h2>

<ul>
<li>现实生活中：电台要发布消息，通过广播把消息广播出去，使用收音机就可以收听广播，得知这条消息</li>
<li>Android中：系统在运行过程中，会产生很多事件，那么某些事件产生时，比如：电量改变、收发短信、拨打电话、屏幕解锁、开机、系统会发送广播，只要应用程序接受到这条广播，就知道系统发生了相应点事件，从而执行相应的代码。使用<strong>广播接收者</strong>，就可以收听广播</li>
<li>在Android中，每次广播消息到来时都会创建BroadcastReceiver实例并执行onReceive() 方法， onReceive() 方法执行完后，BroadcastReceiver 的实例就会被销毁。当onReceive() 方法在10秒内没有执行完毕，Android会认为该程序无响应。所以在BroadcastReceiver里不能做一些比较耗时的操作，否侧会弹出ANR（Application No Response）的对话框。如果需要完成一项比较耗时的工作，应该通过发送Intent给Service，由Service来完成。这里不能使用子线程来解决，因为BroadcastReceiver的生命周期很短，子线程可能还没有结束BroadcastReceiver就先结束了。BroadcastReceiver一旦结束，此时BroadcastReceiver的所在进程很容易在系统需要内存时被优先杀死，因为它属于空进程（没有任何活动组件的进程）。如果它的宿主进程被杀死，那么正在工作的子线程也会被杀死。所以采用子线程来解决是不可靠的。</li>
</ul>


<a name="L....................."></a>
<h3>创建广播接收者</h3>

<ul>
<li>定义java类继承自BroadcastReceiver</li>
<li>在清单文件中定义receiver节点，定义name属性，指定广播接收者java类的全类名</li>
<li><p>指定要接收广播的类型，在intent-filter的节点中，指定action子节点，action的值必须跟要接受的广播中的action匹配</p>

<blockquote><p>打电话广播：&lt;action android:name=&ldquo;android.intent.action.NEW_OUTGOING_CALL&rdquo;/><br>
短信广播：    &lt;action android:name=&ldquo;android.provider.Telephony.SMS_RECEIVED&rdquo; /><br></p></blockquote></li>
<li><p>即便广播接收者所在进程已经被关闭（被系统关闭），当系统发出的广播的action和该广播接收者的action匹配，系统会启动该广播接收者所在的进程，并发送广播至该进程（这就可以不必一直开着广播接收者进程，节约系统资源）</p></li>
<li>4.0后，广播接收者所在进程如果从来没有被启动过，广播接收者不会生效</li>
<li>4.0后，如果系统自动关闭广播接收者所在进程，系统会在广播来时启动进程；但如果广播接收者被用户手动关闭，系统不会在广播来时启动进程，只有用户手动启动时才会再次生效。</li>
</ul>


<a name="L.................."></a>
<h3>短息拦截过滤</h3>

<p>设置短信防火墙优先级，在AndroidManifest.xml中的intent-filter 添加属性 android:priority=&ldquo;1000"，优先级范围为-1000到1000.</p>

<blockquote><p>&lt;action android:name=&ldquo;android.provider.Telephony.SMS_RECEIVED&rdquo; /></p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">){</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//拿到短信的内容</span>
</span><span class='line'>  <span class="c1">//短信内容封装到intent中</span>
</span><span class='line'>  <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getExtras</span><span class="o">();</span>
</span><span class='line'>  <span class="c1">//以pdus为键，取出一个object数组，数组中的每一个元素，都是一条短信</span>
</span><span class='line'>  <span class="n">Object</span><span class="o">[]</span> <span class="n">objects</span> <span class="o">=</span> <span class="o">(</span><span class="n">Object</span><span class="o">[])</span> <span class="n">bundle</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;pdus&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//为什么会有多条短信？  短信内容长度有限制，超出长度会分多条短信发送。</span>
</span><span class='line'>  <span class="k">for</span><span class="o">(</span><span class="n">Object</span> <span class="n">object</span> <span class="o">:</span> <span class="n">objects</span><span class="o">){</span>
</span><span class='line'>      <span class="n">SmsMessage</span> <span class="n">sms</span> <span class="o">=</span> <span class="n">SmsMessage</span><span class="o">.</span><span class="na">createFromPdu</span><span class="o">((</span><span class="kt">byte</span><span class="o">[])</span> <span class="n">object</span><span class="o">);</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">phone</span> <span class="o">=</span> <span class="n">sms</span><span class="o">.</span><span class="na">getOriginatingAddress</span><span class="o">();</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">con</span> <span class="o">=</span> <span class="n">sms</span><span class="o">.</span><span class="na">getMessageBody</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="o">(</span><span class="n">phone</span><span class="o">.</span><span class="na">equal</span><span class="o">(</span><span class="s">&quot;要拦截的号码&quot;</span><span class="o">)){</span>
</span><span class='line'>          <span class="n">abortBroadcast</span><span class="o">();</span><span class="c1">//阻止广播向其他程序传播</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L......SD........."></a>
<h3>监控SD卡状态</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;receiver</span> <span class="na">android:name =</span> <span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>  <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MEDIA\_MOUNTED&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MEDIA\_REMOVED&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MEDIA\_UNMOUNTED&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">&quot;file&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class='line'><span class="nt">&lt;/receiver&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">){</span>
</span><span class='line'>  <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>
</span><span class='line'>  <span class="k">if</span><span class="o">(</span><span class="s">&quot;android.intent.action.MEDIA\_MOUNTED&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">action</span><span class="o">)){</span>
</span><span class='line'>      <span class="c1">//已挂载</span>
</span><span class='line'>  <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="s">&quot;android.intent.action.MEDIA\_REMOVED&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">action</span><span class="o">)){</span>
</span><span class='line'>      <span class="c1">//已移除</span>
</span><span class='line'>  <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="s">&quot;android.intent.action.MEDIA\_UNMOUNTED&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">action</span><span class="o">)){</span>
</span><span class='line'>      <span class="c1">//未挂载</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L............"></a>
<h3>开机自启</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.provider.Telephony.BOOT_COMPLETED&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>//添加权限
</span><span class='line'><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">){</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;已经开机重启！&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="c1">//实现开机自动启动软件</span>
</span><span class='line'>    <span class="n">Intent</span> <span class="n">it</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//由于广播接收者没有前台界面，就没有任务栈，所以要创建任务栈，存放启动的Activity</span>
</span><span class='line'>    <span class="n">it</span><span class="o">.</span><span class="na">setFlags</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">FLAG_ACTIVITY_NEW_TASK</span><span class="o">);</span>
</span><span class='line'>    <span class="n">context</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">it</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............................................."></a>
<h3>监控应用的状态(安装、更新、卸载)</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.PACKAGE_ADDED&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.PACKAGE_REPLACED&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.PACKAGE_REMOVED&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">&quot;package&quot;</span><span class="nt">/&gt;</span> 用于携带数据，哪个应用被安装、更新、卸载了
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">){</span>
</span><span class='line'>  <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>
</span><span class='line'>  <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
</span><span class='line'>  <span class="n">String</span> <span class="n">packageName</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="o">(</span><span class="s">&quot;android.intent.action.PACKAGE_ADDED&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">action</span><span class="o">)){</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="s">&quot;android.intent.action.PACKAGE_REPLACED&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">action</span><span class="o">)){</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="s">&quot;android.intent.action.PACKAGE_REMOVED&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">action</span><span class="o">)){</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L....................."></a>
<h3>发送自定义广播</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">();</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">&quot;cn.annpeter.www&quot;</span><span class="o">);</span> <span class="c1">//广播中的action是自定义的</span>
</span><span class='line'><span class="n">sendBroadcase</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............."></a>
<h3>广播的分类</h3>

<a name="L1............."></a>
<h5>1.无序广播</h5>

<p>所有与广播中的action匹配的广播接收者都可以收到这条广播，并且是没有先后顺序之分的，视为同时收到</p>

<a name="L2............."></a>
<h5>2.有序广播</h5>

<p>所有与广播中的action匹配的接收者都可以收到这条广播，但是是由先后顺序对，按照广播接收者的优先级排序，高优先级先收到，低优先级后收到</p>

<a name="L............"></a>
<h4>有序广播</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//发送有序广播</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">();</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">&quot;cn.annpeter.wwww&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//第三个参数，指定广播接收者（被称为最终接收者，最终接收者一定可以收到广播，</span>
</span><span class='line'><span class="c1">//优先级最低，最后收到广播，无论中间是否进行了拦截，并且无需在清单文件中配置action等内容）</span>
</span><span class='line'><span class="n">sendOrderBroadcast</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="s">&quot;参数，比较简单时，直接在这里传参&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//接收有序广播</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">receiver</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;cn.annpeter.www.R1&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span> <span class="nl">android:</span><span class="n">priority</span><span class="o">=</span><span class="s">&quot;1000&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="n">action</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;cn.annpeter.www&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>    <span class="o">&lt;/</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">receiver</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">receiver</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;cn.annpeter.www.R2&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span> <span class="nl">android:</span><span class="n">priority</span><span class="o">=</span><span class="s">&quot;800&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="n">action</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;cn.annpeter.www&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>    <span class="o">&lt;/</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">receiver</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">receiver</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;cn.annpeter.www.R3&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span> <span class="nl">android:</span><span class="n">priority</span><span class="o">=</span><span class="s">&quot;600&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="n">action</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;cn.annpeter.www&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>    <span class="o">&lt;/</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">receiver</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//接收广播</span>
</span><span class='line'><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">getResultData</span><span class="o">();</span>
</span><span class='line'><span class="c1">//修改广播内容 (只能在有序广播中才有效，无序广播无效)</span>
</span><span class='line'><span class="n">setResultData</span><span class="o">(</span><span class="s">&quot;这是修改后的广播，低优先级收到！&quot;</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..........................."></a>
<h3>代码注册广播接收者</h3>

<ul>
<li><p>清单文件注册广播接收者，广播一旦发出，系统就会去所有清单文件中寻找，哪一个广播接收者的action和广播的action是匹配的，如果找到了，就会把该广播接收者的进程启动起来</p></li>
<li><p>代码注册，需要使用广播接收者时，执行注册的代码，不需要时，执行解除注册对代码</p></li>
</ul>


<a name="L........................"></a>
<h3>特殊的广播接收者</h3>

<p>安卓中有一些广播接收者，必须使用代码注册，清单文件注册是无效的（这些广播太频繁了）</p>

<ol>
<li><p>屏幕锁屏和解锁</p></li>
<li><p>点亮改变</p></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScreenReceiver</span> <span class="kd">extends</span> <span class="n">BroadcastReceiver</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">ACTION_SCREEN_ON</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">action</span><span class="o">)){</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;屏幕关闭&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">ACTION_SCREEN_OFF</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">action</span><span class="o">)){</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;屏幕打开&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//注册广播接收者</span>
</span><span class='line'><span class="c1">//创建对象</span>
</span><span class='line'><span class="n">ScreenReceiver</span> <span class="n">receiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ScreenReceiver</span><span class="o">();</span>
</span><span class='line'><span class="c1">//创建intent-filter对象</span>
</span><span class='line'><span class="n">IntentFilter</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">IntentFilter</span><span class="o">();</span>
</span><span class='line'><span class="n">filter</span><span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">ACTION_SCREEN_ON</span><span class="o">);</span>
</span><span class='line'><span class="n">filter</span><span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">ACTION_SCREEN_OFF</span><span class="o">);</span>
</span><span class='line'><span class="c1">//注册广播接收者</span>
</span><span class='line'><span class="n">registerReceiver</span><span class="o">(</span><span class="n">receiver</span><span class="o">,</span> <span class="n">filter</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//解除注册</span>
</span><span class='line'><span class="n">unregisterReceiver</span><span class="o">(</span><span class="n">receiver</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L.............................."></a>
<h2>服务（四大组件之一）</h2>

<p>运行于后台的一个组件，用来运行后台代码，服务是没有前台界面的，可以视为没有界面的Activity</p>

<a name="L..............."></a>
<h3>进程优先级</h3>

<p>1.Foreground process 拥有一个正在与用户交互的Activity（onResume()方法被调用）的进程
2.Visible process 不在前台，但对用户依然可见，但是没有焦点，如Activity的onPause()方法被调用
3.Service process 通过startService(),开启的进程，杀死后可能会被重启（内存充足）
4.Background process 不可见状态，如Activity的onStop()方法调用后，会变成background process
5.Empty process（通常认为，没有拥有任何活动组件的）</p>

<a name="L....................."></a>
<h3>创建、关闭服务</h3>

<ol>
<li>需要继承自Service类</li>
<li>需要在清单文件application的子节点中声明<service android:name="服务类名全路径"></service></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//首先定义一个MyService的服务类，继承自Service</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//显示启动服务</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'><span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//关闭服务</span>
</span><span class='line'><span class="n">stopService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L....................."></a>
<h3>服务的生命周期</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//服务被创建过一次就不会再次创建了，但是会再次掉用onStartCommand方法</span>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(){</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">int</span> <span class="nf">onStartCommand</span><span class="o">(</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">,</span> <span class="kt">int</span> <span class="n">startId</span><span class="o">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">OnStartCommand</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">flags</span><span class="o">,</span> <span class="n">startId</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">(){</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............."></a>
<h3>电话录音机</h3>

<ul>
<li>空闲状态</li>
<li>响铃状态</li>
<li>摘机状态</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">TelephonyManager</span> <span class="n">tm</span> <span class="o">=</span> <span class="o">(</span><span class="n">TelephonyManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">TELEPHONY_SERVICE</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//listen可以监听很多事件，第二个参数用于指明具体是什么事件</span>
</span><span class='line'><span class="n">tm</span><span class="o">.</span><span class="na">listen</span><span class="o">(</span><span class="k">new</span> <span class="nf">RecordLisener</span><span class="o">(),</span> <span class="n">PhoneStateListener</span><span class="o">.</span><span class="na">LISTEN_CALL_STATE</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">class</span> <span class="nc">RecordLisener</span> <span class="kd">extends</span> <span class="n">PhoneStateListener</span><span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCallStateChanged</span><span class="o">(</span><span class="kt">int</span> <span class="n">state</span><span class="o">,</span> <span class="n">String</span> <span class="n">incomingNumber</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCallStateChanged</span><span class="o">(</span><span class="n">state</span><span class="o">,</span> <span class="n">incomingNumber</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">TelephonyManager</span><span class="o">.</span><span class="na">CALL_STATE_OFFHOOK</span><span class="o">){</span>
</span><span class='line'>            <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;开始录音！&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">TelephonyManager</span><span class="o">.</span><span class="na">CALL_STATE_RINGING</span><span class="o">){</span>
</span><span class='line'>            <span class="n">mediaRecorder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MediaRecorder</span><span class="o">();</span>
</span><span class='line'>            <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">setAudioSource</span><span class="o">(</span><span class="n">MediaRecorder</span><span class="o">.</span><span class="na">AudioSource</span><span class="o">.</span><span class="na">MIC</span><span class="o">);</span>
</span><span class='line'>            <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">setOutputFormat</span><span class="o">(</span><span class="n">MediaRecorder</span><span class="o">.</span><span class="na">OutputFormat</span><span class="o">.</span><span class="na">THREE_GPP</span><span class="o">);</span>
</span><span class='line'>            <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">setOutputFile</span><span class="o">(</span><span class="n">getFilesDir</span><span class="o">()+</span><span class="s">&quot;/recorder.3gp&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">setAudioEncoder</span><span class="o">(</span><span class="n">MediaRecorder</span><span class="o">.</span><span class="na">AudioEncoder</span><span class="o">.</span><span class="na">AMR_NB</span><span class="o">);</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">&quot;LOG_TAG&quot;</span><span class="o">,</span> <span class="s">&quot;prepare() failed&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;电话来了，已经准备好了录音&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">TelephonyManager</span><span class="o">.</span><span class="na">CALL_STATE_IDLE</span><span class="o">){</span>
</span><span class='line'>            <span class="k">if</span><span class="o">(</span><span class="n">mediaRecorder</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
</span><span class='line'>                <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>                <span class="n">mediaRecorder</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span><span class='line'>                <span class="n">mediaRecorder</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;录音已经完毕&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L....................."></a>
<h3>服务的开启方式</h3>

<ul>
<li>startService&ndash;stopService  //涉及到的方法onCreate、onStartCommand、onDestroy

<ul>
<li>该方法启动的是服务进程</li>
<li>Activity一旦启动服务，服务就跟Activity没有关系了</li>
</ul>
</li>
<li>bindService&ndash;unBindService //涉及到的方法onBind、onUnbind

<ul>
<li>该方法启动的不是服务进程</li>
<li>Activity与服务建立连接，Activity一旦死亡，服务也会死亡</li>
<li>安卓通过error触发unBindService，所以在此时报出的错误，并不会让程序崩溃</li>
<li>绑定只能绑定一次，重复解绑会崩溃</li>
</ul>
</li>
</ul>


<p> <strong>bindService这种方式可用于在Activity中调用Service中的方法，通过中间人调用</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//创建Service类</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChuZhangService</span> <span class="kd">extends</span> <span class="n">Service</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//创建中间人类</span>
</span><span class='line'>    <span class="kd">class</span> <span class="nc">ZhouMi</span> <span class="kd">extends</span> <span class="n">Binder</span><span class="o">{</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">qianXian</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">banZheng</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// TODO Auto-generated method stub</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">ZhouMi</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">banZheng</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;处长办证！&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">ZhouMi</span> <span class="n">zm</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="c1">//在Activity中绑定Service，最好在onCreate中绑定，否则可能照成中间人没有初始化成功而失败</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">it</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">ChuZhangService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'><span class="n">bindService</span><span class="o">(</span><span class="n">it</span><span class="o">,</span> <span class="k">new</span> <span class="nf">MyConn</span><span class="o">(),</span> <span class="n">BIND_AUTO_CREATE</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//调用处调用Service中的方法，通过中间人</span>
</span><span class='line'><span class="n">zm</span><span class="o">.</span><span class="na">qianXian</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="kd">class</span> <span class="nc">MyConn</span> <span class="kd">implements</span> <span class="n">ServiceConnection</span><span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onServiceConnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// TODO Auto-generated method stub</span>
</span><span class='line'>        <span class="c1">//初始化中间人</span>
</span><span class='line'>        <span class="n">zm</span> <span class="o">=</span> <span class="o">(</span><span class="n">ZhouMi</span><span class="o">)</span><span class="n">service</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onServiceDisconnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// TODO Auto-generated method stub</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//注意优化</span>
</span><span class='line'><span class="c1">//中间人周秘属于Service，Service可能有一些私有的方法交给周秘做，不想其他人访问到，我们可以定义一个对公接口，</span>
</span><span class='line'><span class="c1">//周秘实现这个接口，在Activity中获得这个接口，访问中间人方法，从而访问到Service中的方法</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L....................."></a>
<h3>服务的混合调用</h3>

<blockquote><p>先开始、再绑定、先解绑、再停止</p></blockquote>

<a name="L.................."></a>
<h3>启动远程服务</h3>

<a name="L..............."></a>
<h4>服务的分类</h4>

<ul>
<li>本地服务： 指的是服务和启动服务的activity在同一个进程中</li>
<li>远程服务： 指的事服务和启动服务的activity在不同的进程中</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//启动远程服务</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">();</span>
</span><span class='line'><span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">&quot;注册的远程服务的类名&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="AIDL.Android.interface.definition.language."></a>
<h4>AIDL(Android interface definition language)</h4>

<p>访问远程服务中的远程方法</p>

<a name="L....................."></a>
<h5>项目一、服务端</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//定义外部访问接口 RInterface.aidl</span>
</span><span class='line'><span class="kd">interface</span> <span class="nc">RInterface</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">play</span><span class="o">();</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">stop</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//定义远程服务 RService.java</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RService</span> <span class="kd">extends</span> <span class="n">Service</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//Stub继承了Binder并实现了RInterface中的接口函数</span>
</span><span class='line'>    <span class="kd">class</span> <span class="nc">RControl</span> <span class="kd">extends</span> <span class="n">Stub</span><span class="o">{</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">RService</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">RemoteException</span> <span class="o">{</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">RControl</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;AnnPeter&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//清单文件中注册Service</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">service</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;.RService&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span> <span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="n">action</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;com.example.fun.RService&quot;</span><span class="o">&gt;&lt;/</span><span class="n">action</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;/</span><span class="n">intent</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">service</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L....................."></a>
<h5>项目二、客户端</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//在项目二中创建一个文件 RInterface.aidl，文件的包名必须和服务端的包名是一样的</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//客户端Activity调用服务接口</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">RInterface</span> <span class="n">ri</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">MyConn</span> <span class="n">myConn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">();</span>
</span><span class='line'>        <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">&quot;com.example.fun.RService&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">intent</span><span class="o">.</span><span class="na">setPackage</span><span class="o">(</span><span class="s">&quot;com.example.fun&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">myConn</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MyConn</span><span class="o">();</span>
</span><span class='line'>        <span class="n">bindService</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">myConn</span><span class="o">,</span> <span class="n">BIND_AUTO_CREATE</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">click</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">ri</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">class</span> <span class="nc">MyConn</span> <span class="kd">implements</span> <span class="n">ServiceConnection</span><span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onServiceConnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">ri</span> <span class="o">=</span> <span class="n">Stub</span><span class="o">.</span><span class="na">asInterface</span><span class="o">(</span><span class="n">service</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onServiceDisconnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............."></a>
<h2>样式和主题</h2>

<a name="L.........styles.xml..............."></a>
<h3>样式在styles.xml文件中定义</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">&quot;styleName&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:textSize&quot;</span><span class="nt">&gt;</span>22sp<span class="nt">&lt;/item&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:textColor&quot;</span><span class="nt">&gt;</span>#00ff00<span class="nt">&lt;/item&gt;</span>
</span><span class='line'>    ...
</span><span class='line'><span class="nt">&lt;/style&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">&quot;styleName1&quot;</span> <span class="na">parent=</span><span class="s">&quot;styleName&quot;</span><span class="nt">&gt;</span>  //继承自styleName样式
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:textSize&quot;</span><span class="nt">&gt;</span>30sp<span class="nt">&lt;/item&gt;</span>
</span><span class='line'>    ...
</span><span class='line'><span class="nt">&lt;/style&gt;</span>
</span><span class='line'>
</span><span class='line'>//继承自styleName样式，在样式表中引用时使用&quot;@style/styleName.styleName2&quot;
</span><span class='line'><span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">&quot;styleName.styleName2&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;android:textSize&quot;</span><span class="nt">&gt;</span>40sp<span class="nt">&lt;/item&gt;</span>
</span><span class='line'>    ...
</span><span class='line'><span class="nt">&lt;/style&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>在代码中设置主题（隐藏Title，只会对本Activity生效：requestWindowFeature(Window.FEATURE_NO_TITLE)）</strong></p>

<a name="L...............................................................Activity...Application.....................View........."></a>
<h3>主题，和样式定义方式是一样的，主题一般用于Activity和Application，样式一般用于View控件上</h3>

<a name="L..............."></a>
<h2>多媒体编程</h2>

<p>包括文本、图片、音频、视频</p>

<a name="L......"></a>
<h3>图片</h3>

<ul>
<li><p>图片在计算机中大小的计算：图片的总大小＝图片的总像素＊每个像素占用的大小</p></li>
<li><p>单色位图：只能表示2种颜色，使用两个数字：0和1，使用一个长度为1的二进制数字就可以表示了，每个像素占用1/8个字节</p></li>
<li><p>16色位图：只能表示16种颜色</p>

<ul>
<li>需要16个数字：0-15，0000-1111</li>
<li>使用一个长度为4的二进制数组就可以表示了</li>
<li>每个像素占用1/2个字节</li>
</ul>
</li>
<li><p>256色位图：能表示256种颜色</p>

<ul>
<li>需要256个数字：0-255，   0000 0000 － 1111 1111</li>
<li>使用一个长度为8的二进制数字</li>
<li>每个像素占用1个字节</li>
</ul>
</li>
<li><p>24位位图：</p>

<ul>
<li>每个像素占用24位，也就是3个字节，所以叫24位位图</li>
<li>R：0-255，需要一个长度为8的二进制数字，占用1个字节</li>
<li>G：0-255，需要一个长度为8的二进制数字，占用1个字节</li>
<li>B：0-255，需要一个长度为8的二进制数字，占用1个字节</li>
</ul>
</li>
</ul>


<a name="L..............."></a>
<h3>加载大图片</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ImageView</span> <span class="n">iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">iv</span><span class="o">);</span>
</span><span class='line'><span class="n">Options</span> <span class="n">op</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Options</span><span class="o">();</span>
</span><span class='line'><span class="c1">//设置先不加载像素内容，只加载边界信息，以获取图片大小</span>
</span><span class='line'><span class="n">op</span><span class="o">.</span><span class="na">inJustDecodeBounds</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'><span class="n">Bitmap</span> <span class="n">bm</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeFile</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">()+</span><span class="s">&quot;/a.jpg&quot;</span><span class="o">,</span> <span class="n">op</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//获取图片大小和屏幕大小，计算缩放比例</span>
</span><span class='line'><span class="kt">int</span> <span class="n">imgW</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="na">outWidth</span><span class="o">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">imgH</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="na">outHeight</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Display</span> <span class="n">display</span> <span class="o">=</span> <span class="n">getWindowManager</span><span class="o">().</span><span class="na">getDefaultDisplay</span><span class="o">();</span>
</span><span class='line'><span class="kt">int</span> <span class="n">sW</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
</span><span class='line'><span class="kt">int</span> <span class="n">sH</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">scaleW</span> <span class="o">=</span> <span class="n">imgW</span> <span class="o">/</span> <span class="n">sW</span><span class="o">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">scaleH</span> <span class="o">=</span> <span class="n">imgH</span> <span class="o">/</span> <span class="n">sH</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="o">(</span><span class="n">scaleW</span> <span class="o">&gt;=</span> <span class="n">scaleH</span> <span class="o">&amp;&amp;</span> <span class="n">scaleW</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">){</span>
</span><span class='line'>    <span class="n">scale</span> <span class="o">=</span> <span class="n">scaleW</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">scaleW</span> <span class="o">&lt;</span> <span class="n">scaleH</span> <span class="o">&amp;&amp;</span> <span class="n">scaleW</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">){</span>
</span><span class='line'>    <span class="n">scale</span> <span class="o">=</span> <span class="n">scaleH</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">op</span><span class="o">.</span><span class="na">inSampleSize</span> <span class="o">=</span> <span class="n">scale</span><span class="o">;</span>
</span><span class='line'><span class="c1">//设置回加载像素模式，否则bm为null</span>
</span><span class='line'><span class="n">op</span><span class="o">.</span><span class="na">inJustDecodeBounds</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'><span class="n">bm</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeFile</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">()+</span><span class="s">&quot;/a.jpg&quot;</span><span class="o">,</span> <span class="n">op</span><span class="o">);</span>
</span><span class='line'><span class="n">iv</span><span class="o">.</span><span class="na">setImageBitmap</span><span class="o">(</span><span class="n">bm</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L.................."></a>
<h3>创建图片副本</h3>

<a name="L.........................................BitmapFactory.decodeFile.................................................."></a>
<h5>在内存中创建一个图片的拷贝, BitmapFactory.decodeFile()获取的图片是只读的，不能进行修改</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//1.在内存中创建一个与原图一样大小的Bitmap对象，创建与原图大小一致的白纸</span>
</span><span class='line'><span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">Bitmap</span><span class="o">.</span><span class="na">createBitmap</span><span class="o">(</span><span class="n">bm</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">bm</span><span class="o">.</span><span class="na">getHeight</span><span class="o">(),</span> <span class="n">bm</span><span class="o">.</span><span class="na">getConfig</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//2.创建画笔对象</span>
</span><span class='line'><span class="n">Paint</span> <span class="n">paint</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Paint</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//3.创建画板对象，把白纸铺在画板上</span>
</span><span class='line'><span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Canvas</span><span class="o">(</span><span class="n">bitmap</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//4.开始作画，把原图的内容绘制在白纸上</span>
</span><span class='line'><span class="n">Matrix</span> <span class="n">mt</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Matrix</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//效果一</span>
</span><span class='line'><span class="c1">//以中心点缩放0.5倍</span>
</span><span class='line'><span class="c1">//mt.setScale(0.5f, 0.5f, bm.getWidth()/2, bm.getHeight()/2);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//效果二</span>
</span><span class='line'><span class="c1">//镜面效果</span>
</span><span class='line'><span class="c1">//mt.setScale(-1, 1);</span>
</span><span class='line'><span class="c1">//mt.postTranslate(bm.getWidth(), 0); //由于使用了两个效果，所以第二个使用post</span>
</span><span class='line'>
</span><span class='line'><span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">bm</span><span class="o">,</span> <span class="n">mt</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">iv</span><span class="o">.</span><span class="na">setImageBitmap</span><span class="o">(</span><span class="n">bitmap</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L........."></a>
<h3>绘图板</h3>

<ul>
<li>SD卡每次准备的时候，系统其实是遍历SD卡所有文件，系统会把所有的媒体文件，都在MediaStore数据库中生成一个索引，数据库中保存了文件的文件名、路径、大小、长度和艺术家</li>
<li>图库、音乐、视屏程序每次启动时，其实不会去遍历SD卡寻找媒体文件，而是直接从MediaStore数据库中读取多媒体文件，通过库中的索引找到对应的多媒体文件后，把文件显示在界面上</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">final</span> <span class="n">ImageView</span> <span class="n">iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">iv</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Bitmap</span> <span class="n">bitmapSrc</span> <span class="o">=</span> <span class="n">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">a</span><span class="o">);</span>
</span><span class='line'><span class="kd">final</span> <span class="n">Bitmap</span> <span class="n">bitmapCopy</span> <span class="o">=</span> <span class="n">Bitmap</span><span class="o">.</span><span class="na">createBitmap</span><span class="o">(</span><span class="n">bitmapSrc</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span>
</span><span class='line'>                      <span class="n">bitmapSrc</span><span class="o">.</span><span class="na">getHeight</span><span class="o">(),</span> <span class="n">bitmapSrc</span><span class="o">.</span><span class="na">getConfig</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'><span class="kd">final</span> <span class="n">Paint</span> <span class="n">paint</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Paint</span><span class="o">();</span>
</span><span class='line'><span class="n">paint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
</span><span class='line'><span class="kd">final</span> <span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Canvas</span><span class="o">(</span><span class="n">bitmapCopy</span><span class="o">);</span>
</span><span class='line'><span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">bitmapSrc</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Matrix</span><span class="o">(),</span> <span class="n">paint</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">iv</span><span class="o">.</span><span class="na">setOnTouchListener</span><span class="o">(</span><span class="k">new</span> <span class="nf">OnTouchListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">float</span> <span class="n">startX</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">startY</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouch</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">,</span> <span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">action</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
</span><span class='line'>        <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">switch</span> <span class="o">(</span><span class="n">action</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">:</span>
</span><span class='line'>            <span class="n">startX</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
</span><span class='line'>            <span class="n">startY</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
</span><span class='line'>            <span class="k">break</span><span class="o">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_MOVE</span><span class="o">:</span>
</span><span class='line'>            <span class="n">canvas</span><span class="o">.</span><span class="na">drawLine</span><span class="o">(</span><span class="n">startX</span><span class="o">,</span> <span class="n">startY</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
</span><span class='line'>            <span class="n">iv</span><span class="o">.</span><span class="na">setImageBitmap</span><span class="o">(</span><span class="n">bitmapCopy</span><span class="o">);</span>
</span><span class='line'>            <span class="n">startX</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
</span><span class='line'>            <span class="n">startY</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
</span><span class='line'>            <span class="k">break</span><span class="o">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span><span class="o">:</span>
</span><span class='line'>            <span class="c1">//保存图片</span>
</span><span class='line'>            <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">()+</span><span class="s">&quot;/a.png&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="n">bitmapCopy</span><span class="o">.</span><span class="na">compress</span><span class="o">(</span><span class="n">CompressFormat</span><span class="o">.</span><span class="na">PNG</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="n">fos</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//发送SD卡就绪广播，让系统遍历SD卡</span>
</span><span class='line'>            <span class="n">Intent</span> <span class="n">mediaScanIntent</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">KITKAT</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mediaScanIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_SCANNER_SCAN_FILE</span><span class="o">);</span>
</span><span class='line'>                <span class="n">Uri</span> <span class="n">contentUri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="n">file</span><span class="o">);</span> <span class="c1">//out is your output file</span>
</span><span class='line'>                <span class="n">mediaScanIntent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">contentUri</span><span class="o">);</span>
</span><span class='line'>                <span class="n">sendBroadcast</span><span class="o">(</span><span class="n">mediaScanIntent</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mediaScanIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_MOUNTED</span><span class="o">);</span>
</span><span class='line'>                <span class="n">mediaScanIntent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">()));</span>
</span><span class='line'>                <span class="n">sendBroadcast</span><span class="o">(</span><span class="n">mediaScanIntent</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="k">break</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............."></a>
<h3>音乐播放器</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MusicService</span> <span class="kd">extends</span> <span class="n">Service</span><span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">MediaPlayer</span> <span class="n">mediaPlayer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">Timer</span> <span class="n">timer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//中间人处理</span>
</span><span class='line'>    <span class="kd">class</span> <span class="nc">MusicControler</span> <span class="kd">extends</span> <span class="n">Binder</span> <span class="kd">implements</span> <span class="n">MusicInterface</span><span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">MusicService</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">MusicService</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pause</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">MusicService</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">pause</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">seekTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">msec</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">MusicService</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">seekTo</span><span class="o">(</span><span class="n">msec</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">(){</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">mediaPlayer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
</span><span class='line'>            <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mediaPlayer</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MediaPlayer</span><span class="o">();</span>
</span><span class='line'>                <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">//方式一：播放本地音乐</span>
</span><span class='line'>                <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">()+</span>
</span><span class='line'>                                            <span class="s">&quot;/Mine.mp3&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
</span><span class='line'>                <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">//方式二：播放网路音乐</span>
</span><span class='line'>                <span class="c1">//mediaPlayer.setDataSource(&quot;http://192.168.1.109/musics/Mine.mp3&quot;);</span>
</span><span class='line'>                <span class="c1">//mediaPlayer.prepareAsync();</span>
</span><span class='line'>                <span class="c1">//mediaPlayer.setOnPreparedListener(new OnPreparedListener() {</span>
</span><span class='line'>                <span class="c1">//  @Override</span>
</span><span class='line'>                <span class="c1">//  public void onPrepared(MediaPlayer mp) {</span>
</span><span class='line'>                <span class="c1">//  mediaPlayer.start();</span>
</span><span class='line'>                <span class="c1">//  }</span>
</span><span class='line'>                <span class="c1">//});</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">addTimer</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addTimer</span><span class="o">(){</span>
</span><span class='line'>        <span class="kd">final</span> <span class="kt">int</span> <span class="n">totalTime</span> <span class="o">=</span> <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">getDuration</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">timer</span> <span class="o">=</span>  <span class="k">new</span> <span class="nf">Timer</span><span class="o">();</span>
</span><span class='line'>        <span class="n">timer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="k">new</span> <span class="nf">TimerTask</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Handler</span> <span class="n">handler</span> <span class="o">=</span> <span class="n">MainActivity</span><span class="o">.</span><span class="na">handler</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>                <span class="kt">int</span> <span class="n">currentPos</span> <span class="o">=</span> <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">getCurrentPosition</span><span class="o">();</span>
</span><span class='line'>                <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Bundle</span><span class="o">();</span>
</span><span class='line'>                <span class="n">bundle</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="s">&quot;totalTime&quot;</span><span class="o">,</span> <span class="n">totalTime</span><span class="o">);</span>
</span><span class='line'>                <span class="n">bundle</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="s">&quot;currentPos&quot;</span><span class="o">,</span> <span class="n">currentPos</span><span class="o">);</span>
</span><span class='line'>                <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Message</span><span class="o">();</span>
</span><span class='line'>                <span class="n">msg</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
</span><span class='line'>                <span class="n">handler</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">},</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">seekTo</span><span class="o">(</span><span class="kt">int</span> <span class="n">msec</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">seekTo</span><span class="o">(</span><span class="n">msec</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">mediaPlayer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
</span><span class='line'>            <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>            <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span><span class='line'>            <span class="n">mediaPlayer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>            <span class="n">timer</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pause</span><span class="o">(){</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">mediaPlayer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
</span><span class='line'>            <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">pause</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// TODO Auto-generated method stub</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// TODO Auto-generated method stub</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">MusicControler</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
</span><span class='line'>        <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>        <span class="n">mediaPlayer</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span><span class='line'>        <span class="n">mediaPlayer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>        <span class="n">timer</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/upload/2015/OCT/20/imgs/1445312355.png" alt="MediaPlayer调用示意图" /></p>

<a name="L............"></a>
<h3>视频处理</h3>

<a name="SurfaceView"></a>
<h4>SurfaceView</h4>

<ul>
<li>双缓冲技术</li>
<li>重量级组件</li>
<li>只要不可见，就不会创建；可见时，才会创建。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">SurfaceView</span> <span class="n">sv</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">MediaPlayer</span> <span class="n">mp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">currentPos</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">sv</span> <span class="o">=</span> <span class="o">(</span><span class="n">SurfaceView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">sv</span><span class="o">);</span>
</span><span class='line'>        <span class="kd">final</span> <span class="n">SurfaceHolder</span> <span class="n">sh</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="na">getHolder</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">sh</span><span class="o">.</span><span class="na">addCallback</span><span class="o">(</span><span class="k">new</span> <span class="nf">Callback</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceDestroyed</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">//因为SurfaceView不可见，就会被销毁，所以mp也应当销毁重建</span>
</span><span class='line'>                <span class="k">if</span><span class="o">(</span><span class="n">mp</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
</span><span class='line'>                    <span class="n">currentPos</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="na">getCurrentPosition</span><span class="o">();</span>
</span><span class='line'>                    <span class="n">mp</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>                    <span class="n">mp</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span><span class='line'>                    <span class="n">mp</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceCreated</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span><span class="o">(</span><span class="n">mp</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
</span><span class='line'>                    <span class="n">mp</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MediaPlayer</span><span class="o">();</span>
</span><span class='line'>                    <span class="n">mp</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
</span><span class='line'>                    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">mp</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="s">&quot;sdcard/Download/3.mp4&quot;</span><span class="o">);</span>
</span><span class='line'>                        <span class="n">mp</span><span class="o">.</span><span class="na">setDisplay</span><span class="o">(</span><span class="n">sh</span><span class="o">);</span>
</span><span class='line'>                        <span class="n">mp</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
</span><span class='line'>                        <span class="n">mp</span><span class="o">.</span><span class="na">seekTo</span><span class="o">(</span><span class="n">currentPos</span><span class="o">);</span>
</span><span class='line'>                        <span class="n">mp</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">surfaceChanged</span><span class="o">(</span><span class="n">SurfaceHolder</span> <span class="n">holder</span><span class="o">,</span> <span class="kt">int</span> <span class="n">format</span><span class="o">,</span> <span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">});</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="VideoView"></a>
<h4>VideoView</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">VideoView</span> <span class="n">vv</span> <span class="o">=</span> <span class="o">(</span><span class="n">VideoView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">vv</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">vv</span><span class="o">.</span><span class="na">setVideoPath</span><span class="o">(</span><span class="s">&quot;sdcard/2.mp4&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">vv</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="FFMPEG"></a>
<h4>FFMPEG</h4>

<p>开源免费的音视频编解码器</p>

<a name="Vitamio"></a>
<h4>Vitamio</h4>

<ul>
<li>封装了FFMPEG的视频播放框架</li>
<li>对外提供的API全部都是javaAPI</li>
</ul>


<a name="L.................."></a>
<h3>拍照摄像使用</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">takePhoto</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">();</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">ACTION_IMAGE_CAPTURE</span><span class="o">);</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">EXTRA_OUTPUT</span><span class="o">,</span><span class="n">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">(),</span> <span class="s">&quot;1.jpg&quot;</span><span class="o">)));</span>
</span><span class='line'>    <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">takeVedio</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">();</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">ACTION_VIDEO_CAPTURE</span><span class="o">);</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">EXTRA_OUTPUT</span><span class="o">,</span><span class="n">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">(),</span> <span class="s">&quot;1.3gp&quot;</span><span class="o">)));</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">EXTRA_VIDEO_QUALITY</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
</span><span class='line'>        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;拍照成功&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="mi">10</span><span class="o">){</span>
</span><span class='line'>        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;摄像成功&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L......................................."></a>
<h2>内容提供者（四大组件之一）</h2>

<p>把数据暴露给其他应用，通常，是把私有数据库中的数据暴露给其它应用</p>

<a name="L........................"></a>
<h5>自定义内容提供者</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//定义数据库辅助类</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DBOpenHelper</span> <span class="kd">extends</span> <span class="n">SQLiteOpenHelper</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">DBOpenHelper</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">&quot;peopel.db&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="s">&quot;create table people(_id integer primary key autoincrement, name char(10), phone char(11))&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="s">&quot;create table teacher(_id integer primary key autoincrement, name char(10)&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onUpgrade</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldVersion</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newVersion</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//创建自定义内容提供者，重写内容提供者方法</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PeoplerProvider</span> <span class="kd">extends</span> <span class="n">ContentProvider</span><span class="o">{</span>
</span><span class='line'>    <span class="n">DBOpenHelper</span> <span class="n">dbOpenHelper</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">SQLiteDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">dbOpenHelper</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DBOpenHelper</span><span class="o">(</span><span class="n">getContext</span><span class="o">());</span>
</span><span class='line'>        <span class="n">db</span> <span class="o">=</span> <span class="n">dbOpenHelper</span><span class="o">.</span><span class="na">getWritableDatabase</span><span class="o">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Cursor</span> <span class="nf">query</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">projection</span><span class="o">,</span> <span class="n">String</span> <span class="n">selection</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">selectionArgs</span><span class="o">,</span> <span class="n">String</span> <span class="n">sortOrder</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">&quot;people&quot;</span><span class="o">,</span> <span class="n">projection</span><span class="o">,</span> <span class="n">selection</span><span class="o">,</span> <span class="n">selectionArgs</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">sortOrder</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getType</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Uri</span> <span class="nf">insert</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">,</span> <span class="n">ContentValues</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">db</span><span class="o">.</span><span class="na">insertOrThrow</span><span class="o">(</span><span class="s">&quot;people&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">uri</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">delete</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">,</span> <span class="n">String</span> <span class="n">selection</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">selectionArgs</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">&quot;people&quot;</span><span class="o">,</span> <span class="n">selection</span><span class="o">,</span> <span class="n">selectionArgs</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">update</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">,</span> <span class="n">ContentValues</span> <span class="n">values</span><span class="o">,</span> <span class="n">String</span> <span class="n">selection</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">selectionArgs</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;people&quot;</span><span class="o">,</span> <span class="n">values</span><span class="o">,</span> <span class="n">selection</span><span class="o">,</span> <span class="n">selectionArgs</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//在主配置文件中声明内容提供者</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">provider</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;com.example.contentprovider.provider.PeoplerProvider&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">authorities</span><span class="o">=</span><span class="s">&quot;com.example.contentprovider.provider.PeoplerProvider&quot;</span>
</span><span class='line'>    <span class="nl">android:</span><span class="n">exported</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">provider</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L.............................."></a>
<h5>访问自定义内容提供者</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">ContentResolver</span> <span class="n">cr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>        <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;content://com.example.contentprovider.provider.PeoplerProvider&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="c1">//通过Uri传递表名参数</span>
</span><span class='line'>        <span class="c1">//uri = Uri.parse(&quot;content://com.example.contentprovider.provider.PeoplerProvider/people&quot;);</span>
</span><span class='line'>        <span class="n">cr</span> <span class="o">=</span> <span class="n">getContentResolver</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insert</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="n">ContentValues</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ContentValues</span><span class="o">();</span>
</span><span class='line'>        <span class="n">values</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Peter&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">values</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;phone&quot;</span><span class="o">,</span> <span class="s">&quot;123456&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">cr</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="n">cr</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="s">&quot;name=?&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&quot;AA&quot;</span><span class="o">});</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updata</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="n">ContentValues</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ContentValues</span><span class="o">();</span>
</span><span class='line'>        <span class="n">values</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;AA&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">cr</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="n">values</span><span class="o">,</span> <span class="s">&quot;name=?&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&quot;Peter&quot;</span><span class="o">});</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">select</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="n">Cursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">cr</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="kc">null</span> <span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">while</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">moveToNext</span><span class="o">()){</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndex</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">));</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">phone</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getColumnIndex</span><span class="o">(</span><span class="s">&quot;phone&quot;</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot;    &quot;</span> <span class="o">+</span> <span class="n">phone</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L......Uri.........................................."></a>
<h4>使用Uri匹配器判断携带的路径（表名）</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">static</span> <span class="n">UriMatcher</span> <span class="n">um</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">UriMatcher</span><span class="o">(</span><span class="n">UriMatcher</span><span class="o">.</span><span class="na">NO_MATCH</span><span class="o">);</span>
</span><span class='line'><span class="kd">static</span><span class="o">{</span>
</span><span class='line'>    <span class="c1">//content://com.example.contentprovider.provider.PeoplerProvider/people</span>
</span><span class='line'>    <span class="n">um</span><span class="o">.</span><span class="na">addURI</span><span class="o">(</span><span class="s">&quot;com.example.contentprovider.provider.PeoplerProvider&quot;</span><span class="o">,</span> <span class="s">&quot;people&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="c1">//content://com.example.contentprovider.provider.PeoplerProvider/teacher</span>
</span><span class='line'>    <span class="n">um</span><span class="o">.</span><span class="na">addURI</span><span class="o">(</span><span class="s">&quot;com.example.contentprovider.provider.PeoplerProvider&quot;</span><span class="o">,</span> <span class="s">&quot;teacher&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
</span><span class='line'>    <span class="c1">//content://com.example.contentprovider.provider.PeoplerProvider/teacher/#</span>
</span><span class='line'>    <span class="n">um</span><span class="o">.</span><span class="na">addURI</span><span class="o">(</span><span class="s">&quot;com.example.contentprovider.provider.PeoplerProvider/#&quot;</span><span class="o">,</span> <span class="s">&quot;teacher&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//调用的时候</span>
</span><span class='line'><span class="c1">//Uri uri = Uri.parse(&quot;content://com.example.contentprovider.provider.PeoplerProvider/people/123&quot;);</span>
</span><span class='line'><span class="c1">//cr.insert(uri, values);</span>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="n">Uri</span> <span class="nf">insert</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">,</span> <span class="n">ContentValues</span> <span class="n">values</span><span class="o">){</span>
</span><span class='line'>    <span class="c1">//使用uri匹配器匹配传入的uri</span>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span><span class="n">um</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">){</span>
</span><span class='line'>        <span class="n">db</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">&quot;people&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">um</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="s">&quot;teacher&quot;</span><span class="o">)</span> <span class="o">==</span> <span class="mi">2</span><span class="o">){</span>
</span><span class='line'>        <span class="n">db</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">&quot;teacher&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">um</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="s">&quot;teacher&quot;</span><span class="o">)</span> <span class="o">==</span> <span class="mi">3</span><span class="o">){</span>
</span><span class='line'>        <span class="c1">//获取uri末尾携带的数字</span>
</span><span class='line'>        <span class="c1">//long id = ContentUris.parseId(uri);</span>
</span><span class='line'>        <span class="n">db</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">&quot;teacher&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span><span class="k">else</span><span class="o">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">&quot;error args&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">uri</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L..............."></a>
<h3>短信数据库</h3>

<a name="sms..."></a>
<h5>sms表</h5>

<ul>
<li>body:短信内容</li>
<li>date:短信时间</li>
<li>address:对方号码</li>
<li>type:发送还是接收</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getMsg</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="n">ContentResolver</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">getContentResolver</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Cursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">cr</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;content://sms&quot;</span><span class="o">),</span>
</span><span class='line'>                      <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&quot;address&quot;</span><span class="o">,</span> <span class="s">&quot;date&quot;</span><span class="o">,</span> <span class="s">&quot;body&quot;</span><span class="o">,</span> <span class="s">&quot;type&quot;</span><span class="o">},</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>        <span class="k">while</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">moveToNext</span><span class="o">()){</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">address</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">date</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">address</span> <span class="o">+</span> <span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="o">+</span> <span class="s">&quot;   &quot;</span> <span class="o">+</span> <span class="n">body</span> <span class="o">+</span> <span class="s">&quot;    &quot;</span> <span class="o">+</span> <span class="n">type</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//主配文件中添加权限</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.permission.READ_SMS&quot;</span><span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L.................."></a>
<h3>联系人数据库</h3>

<ul>
<li>raw_contacts表</li>
<li>contact_id: 联系人id</li>
<li>data表: 存放联系人的详细信息，每行数据是单独的一条联系人的信息</li>
<li>data1: 联系人的具体信息内容</li>
<li>raw_contact_id: 该行信息属于哪一个联系人</li>
<li>mimetype_id: 该行信息属于什么类型</li>
<li>mimetype表: mimetype_id对应的类型的字符串</li>
</ul>


<a name="L..............."></a>
<h3>内容观察者</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span><span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">){</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//注册一个内容观察者，监听短信数据库内容的改变</span>
</span><span class='line'>        <span class="n">ContentResolver</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">getContentResolver</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//uri：监听哪一个uri上的内容提供者的通知</span>
</span><span class='line'>        <span class="c1">//notifyForDescendents：如果是true，那么只要以content:</span>
</span><span class='line'>      <span class="c1">//sms开头的uri的数据改变都能收到通知；否则必须精确匹配</span>
</span><span class='line'>        <span class="n">cr</span><span class="o">.</span><span class="na">registerContentObserver</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;content://sms&quot;</span><span class="o">),</span> <span class="kc">true</span><span class="o">,</span>
</span><span class='line'>                                  <span class="k">new</span> <span class="nf">MyObserver</span><span class="o">(</span><span class="k">new</span> <span class="n">Handler</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">class</span> <span class="nc">MyObserver</span> <span class="kd">extends</span> <span class="n">ContentObserver</span><span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">public</span> <span class="nf">MyObserver</span><span class="o">(</span><span class="n">Handler</span> <span class="n">handler</span><span class="o">){</span>
</span><span class='line'>            <span class="kd">super</span><span class="o">(</span><span class="n">handler</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//收到数据改变通知，此方法调用</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onChange</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">selfChange</span><span class="o">){</span>
</span><span class='line'>            <span class="kd">super</span><span class="o">.</span><span class="na">onChange</span><span class="o">(</span><span class="n">selfChange</span><span class="o">);</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;短信数据库改变&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L........................................................."></a>
<h4>在自定义内容提供者中发送内容观察者通知</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//在数据改变时添加代码</span>
</span><span class='line'><span class="n">getContext</span><span class="o">().</span><span class="na">getContentResolver</span><span class="o">().</span><span class="na">notifyChange</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Fragment"></a>
<h2>Fragment</h2>

<ul>
<li>布局文件，Fragment必须放在帧布局中</li>
<li>Fragment中的组件的id最好和Activity中组件的id不一样，不然在组件中调用Activity中的方法时，该方法中又同时调用了find ViewById()这一方法，那么优先在fragment中寻找，而不会在Activity中去寻找。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//定义Fragment01类继承自Fragment类，重写onCreateView方法</span>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment01</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//在Activity中显示Fragment01返回的View</span>
</span><span class='line'><span class="n">Fragment01</span> <span class="n">f1</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Fragment01</span><span class="o">();</span>
</span><span class='line'><span class="c1">//获取Fragment管理器</span>
</span><span class='line'><span class="n">FragmentManager</span> <span class="n">fm</span> <span class="o">=</span> <span class="n">getFragmentManager</span><span class="o">();</span>
</span><span class='line'><span class="c1">//打开事务</span>
</span><span class='line'><span class="n">FragmentTransaction</span> <span class="n">ft</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
</span><span class='line'><span class="c1">//把内容显示在帧布局中</span>
</span><span class='line'><span class="n">ft</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">fl</span><span class="o">,</span> <span class="n">f1</span><span class="o">);</span>
</span><span class='line'><span class="c1">//提交事务</span>
</span><span class='line'><span class="n">ft</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Fragment.................."></a>
<h3>Fragment生命周期方法</h3>

<ul>
<li>fragment之间切换的时候，先销毁旧的，然后创建新的。</li>
<li>fragment和activity的方法是绑定的</li>
</ul>


<a name="L.........FrameAnimation.Drawable.Animation."></a>
<h2>帧动画FrameAnimation(Drawable Animation)</h2>

<ol>
<li>现在资源文件res/drawable/中定义动画文件</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;animation-list</span>
</span><span class='line'>    <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="na">android:oneshot=</span><span class="s">&quot;false&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00001&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00002&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00003&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00004&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00005&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00006&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00007&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00008&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00009&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00010&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00011&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/paoku00012&quot;</span> <span class="na">android:duration=</span><span class="s">&quot;200&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/animation-list&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>开启动画播放</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ImageView</span> <span class="n">iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">imageView1</span><span class="o">);</span>
</span><span class='line'><span class="n">iv</span><span class="o">.</span><span class="na">setBackgroundResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">animation</span><span class="o">);</span>
</span><span class='line'><span class="n">AnimationDrawable</span> <span class="n">ad</span> <span class="o">=</span> <span class="o">(</span><span class="n">AnimationDrawable</span><span class="o">)</span> <span class="n">iv</span><span class="o">.</span><span class="na">getBackground</span><span class="o">();</span>
</span><span class='line'><span class="n">ad</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L............"></a>
<h3>补间动画</h3>

<a name="L............"></a>
<h4>位移动画</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ImageView</span> <span class="n">iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">iv</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">TranslateAnimation</span> <span class="n">ta</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TranslateAnimation</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
</span><span class='line'><span class="n">ta</span><span class="o">.</span><span class="na">setDuration</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
</span><span class='line'><span class="n">iv</span><span class="o">.</span><span class="na">startAnimation</span><span class="o">(</span><span class="n">ta</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L............"></a>
<h4>缩放动画</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ImageView</span> <span class="n">iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">iv</span><span class="o">);</span>
</span><span class='line'><span class="n">ScaleAnimation</span> <span class="n">sa</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ScaleAnimation</span><span class="o">(</span><span class="mf">0.5f</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mf">0.1f</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>
</span><span class='line'><span class="n">ta</span><span class="o">.</span><span class="na">setDuration</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
</span><span class='line'><span class="c1">//填充结束位置</span>
</span><span class='line'><span class="n">sa</span><span class="o">.</span><span class="na">setFillAfter</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'><span class="n">iv</span><span class="o">.</span><span class="na">startAnimation</span><span class="o">(</span><span class="n">sa</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L........."></a>
<h4>透明度</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ImageView</span> <span class="n">iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">iv</span><span class="o">);</span>
</span><span class='line'><span class="n">AlphaAnimation</span> <span class="n">aa</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AlphaAnimation</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mf">0.5f</span><span class="o">);</span>
</span><span class='line'><span class="n">ta</span><span class="o">.</span><span class="na">setDuration</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
</span><span class='line'><span class="n">iv</span><span class="o">.</span><span class="na">startAnimation</span><span class="o">(</span><span class="n">aa</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L............"></a>
<h4>旋转动画</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ImageView</span> <span class="n">iv</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">iv</span><span class="o">);</span>
</span><span class='line'><span class="n">RotateAnimation</span> <span class="n">ra</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">RotateAnimation</span><span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="mi">180</span><span class="o">,</span> <span class="n">iv</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">iv</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">/</span> <span class="mi">2</span><span class="o">);</span>
</span><span class='line'><span class="n">ta</span><span class="o">.</span><span class="na">setDuration</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
</span><span class='line'><span class="n">iv</span><span class="o">.</span><span class="na">startAnimation</span><span class="o">(</span><span class="n">aa</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L........................"></a>
<h4>多种动画一起播放</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Animation</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AnimationSet</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'><span class="n">set</span><span class="o">.</span><span class="na">addAnimation</span><span class="o">();</span> <span class="c1">//添加各种动画即可</span>
</span><span class='line'><span class="n">iv</span><span class="o">.</span><span class="na">startAnimation</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong><em>补间动画只是改变了在屏幕上的绘制效果，但该Object还是在原来等位置
而属性动画，就把Object的位置也改变了</em></strong></p>

<a name="L............"></a>
<h3>属性动画</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//target:动画作用于哪个组件</span>
</span><span class='line'><span class="c1">//具有set、get方法的就是属性</span>
</span><span class='line'><span class="n">ObjectAnimator</span> <span class="n">oa</span> <span class="o">=</span> <span class="n">ObjectAnimator</span><span class="o">.</span><span class="na">ofFloat</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//多个属性一起作用</span>
</span><span class='line'><span class="n">AnimatorSet</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AnimatiorSet</span><span class="o">();</span>
</span><span class='line'><span class="n">set</span><span class="o">.</span><span class="na">playSquetially</span><span class="o">();</span> <span class="c1">//顺序作用</span>
</span><span class='line'><span class="n">set</span><span class="o">.</span><span class="na">playTogether</span><span class="o">();</span>   <span class="c1">//一起作用</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//还可以用xml文件定义属性动画</span>
</span><span class='line'><span class="c1">//在res/animator文件夹下创建动画xml</span>
</span><span class='line'><span class="n">Animator</span> <span class="n">at</span> <span class="o">=</span> <span class="n">AnimatorInflater</span><span class="o">.</span><span class="na">loadAnimator</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">animator</span><span class="o">.</span><span class="na">objanimator</span><span class="o">);</span>
</span><span class='line'><span class="n">at</span><span class="o">.</span><span class="na">setTarget</span><span class="o">(</span><span class="n">target</span><span class="o">);</span>
</span><span class='line'><span class="n">at</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<a name="JNI.java.native.interface."></a>
<h2>JNI(java native interface)</h2>

<a name="L......"></a>
<h4>工具</h4>

<ul>
<li>NDK: native development kit   开发jni必备，模拟其它平台特性来编译的工具</li>
<li>CDT: c/c++ development tools  高亮显示C语言工具等</li>
<li>cygwin: 一个模拟器，可以在windows下运行Linux指令</li>
</ul>


<a name="NDK............"></a>
<h4>NDK目录结构</h4>

<ul>
<li>docs:帮助文档</li>
<li>build/tools:Linux的批处理文件</li>
<li>platforms:编译c代码需要使用的头文件和类库</li>
<li>prebuild:预编译要使用的二进制文件</li>
<li>toolchains:工具链</li>
<li>ndk-build.cmd:编译打包c代码的指令</li>
</ul>


<a name="L......jni"></a>
<h3>使用jni</h3>

<ol>
<li>在项目根目录下创建jni文件夹</li>
<li>在jni文件中创建一个c文件</li>
<li>在java代码中，创建一个本地方法helloFromC
 public native String helloFromC();</li>
<li>在jni中定义函数实现这个方法</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">jstring</span> <span class="nf">java_com_example_ndkhellloworld_helloFromC</span><span class="p">(</span><span class="n">JNIEnv</span><span class="o">*</span> <span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">thiz</span><span class="p">){</span>
</span><span class='line'>  <span class="kt">char</span><span class="o">*</span> <span class="n">arr</span> <span class="o">=</span> <span class="s">&quot;hello from c&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">jstring</span> <span class="n">jstr</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">arr</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">jstr</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>在jni中创建Android.mk文件</li>
<li>在c文件中添加&lt;jni.h>头文件</li>
<li>在jni文件夹下执行ndk-build指令</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">static</span><span class="o">{</span>
</span><span class='line'>  <span class="c1">//加载动态库</span>
</span><span class='line'>  <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">&quot;fill&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L......x86......"></a>
<h3>支持x86架构</h3>

<p>在Application.mk中添加 APP_ABI := armeabi armeabi-v7a x86</p>

<a name="L..............."></a>
<h3>支持全平台</h3>

<p>在Application.mk中添加 APP_ABI := all</p>

<a name="javah"></a>
<h3>javah</h3>

<ul>
<li>1.7: 在src目录下执行javah 包名.类名</li>
<li>1.6: 在bin/classes目录下执行javah 包名.类名</li>
</ul>


<a name="L..............."></a>
<h3>自动化完成</h3>

<ul>
<li>点击项目右键Android Tools->Add Native Support</li>
<li>关联NDK源码,项目右键Properties->C/C++ General->Paths and Symbals->Add->File System (导入NDK中platform下对应版本的include文件)</li>
<li>注意使用c还是使用c++，修改支持平台</li>
<li>在java代码中创建本地方法，然后使用javah生成对应c函数头</li>
</ul>


<a name="JNI............"></a>
<h3>JNI常用方法</h3>

<a name="java............c........."></a>
<h4>java字符串转c字符串</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">char</span><span class="o">*</span> <span class="nf">Jstring2CStr</span><span class="p">(</span><span class="n">JNIEnv</span><span class="o">*</span> <span class="n">env</span><span class="p">,</span> <span class="n">jstring</span> <span class="n">jstr</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>     <span class="kt">char</span><span class="o">*</span> <span class="n">rtn</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>     <span class="n">jclass</span> <span class="n">clsstring</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="s">&quot;java/lang/String&quot;</span><span class="p">);</span>
</span><span class='line'>     <span class="n">jstring</span> <span class="n">strencode</span> <span class="o">=</span> <span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="s">&quot;GB2312&quot;</span><span class="p">);</span>
</span><span class='line'>     <span class="n">jmethodID</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">clsstring</span><span class="p">,</span> <span class="s">&quot;getBytes&quot;</span><span class="p">,</span> <span class="s">&quot;(Ljava/lang/String;)[B&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>     <span class="c1">// String .getByte(&quot;GB2312&quot;);</span>
</span><span class='line'>     <span class="n">jbyteArray</span> <span class="n">barr</span><span class="o">=</span> <span class="p">(</span><span class="n">jbyteArray</span><span class="p">)(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CallObjectMethod</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">jstr</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">strencode</span><span class="p">);</span>
</span><span class='line'>     <span class="n">jsize</span> <span class="n">alen</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetArrayLength</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">barr</span><span class="p">);</span>
</span><span class='line'>     <span class="n">jbyte</span><span class="o">*</span> <span class="n">ba</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetByteArrayElements</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">barr</span><span class="p">,</span><span class="n">JNI_FALSE</span><span class="p">);</span>
</span><span class='line'>     <span class="k">if</span><span class="p">(</span><span class="n">alen</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>      <span class="n">rtn</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">alen</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>  <span class="c1">//&quot;\0&quot;</span>
</span><span class='line'>      <span class="n">memcpy</span><span class="p">(</span><span class="n">rtn</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">alen</span><span class="p">);</span>
</span><span class='line'>      <span class="n">rtn</span><span class="p">[</span><span class="n">alen</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>     <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ReleaseByteArrayElements</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">barr</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>     <span class="k">return</span> <span class="n">rtn</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L......java............"></a>
<h4>获取java数组长度</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetArrayLength</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">arr</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span><span class="o">*</span> <span class="n">arrp</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetIntArrayElements</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<a name="C......Java......"></a>
<h3>C调用Java方法</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="c1">//打印Log日志</span>
</span><span class='line'><span class="cp">#include &lt;android/log.h&gt;</span>
</span><span class='line'><span class="cp">#incluce LOG_TAG &quot;System.out&quot;</span>
</span><span class='line'><span class="cp">#define LOGD(...) __android_log_print(ANDROID_LOG_DEBUG, LOG_TAG, __VA_ARGS__) </span><span class="c1">//打印debug信息</span>
</span><span class='line'><span class="cp">#define LOGI(...) __android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__)  </span><span class="c1">//打印info信息</span>
</span><span class='line'><span class="c1">//在Android.mk中添加LOCAL_LDLIBS += -llog</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//Java反射</span>
</span><span class='line'><span class="c1">//首先定义一个Dialog类，类中有一个show方法，参数为string类型</span>
</span><span class='line'><span class="c1">//1.拿到类的字节码</span>
</span><span class='line'><span class="n">Class</span> <span class="n">clazz</span> <span class="o">=</span> <span class="n">Demo</span><span class="p">.</span><span class="n">class</span><span class="p">.</span><span class="n">getClassLoader</span><span class="p">(</span><span class="s">&quot;Dialog&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//2.拿到方法</span>
</span><span class='line'><span class="n">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="n">clazz</span><span class="p">.</span><span class="n">getDeclaredMethod</span><span class="p">(</span><span class="s">&quot;show&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>
</span><span class='line'><span class="c1">//3.调用方法</span>
</span><span class='line'><span class="n">method</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">clazz</span><span class="p">.</span><span class="n">newInstance</span><span class="p">(),</span> <span class="s">&quot;这里是实参&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//C调用Java的反射</span>
</span><span class='line'><span class="n">jclass</span> <span class="n">clazz</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;com/example/ccalljava/MainActivity&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">jmethodID</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">clazz</span><span class="p">,</span> <span class="s">&quot;方法名&quot;</span><span class="p">,</span> <span class="s">&quot;方法签名&quot;</span><span class="p">);</span> <span class="c1">//使用javap获取方法签名</span>
</span><span class='line'><span class="c1">//获取签名做法，到项目的classes目录中，使用(javap -s 包名.类名)即可获取签名</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//这里参数使用了中文，注意将.c文件保存为utf-8编码格式保存，否则程序会崩溃</span>
</span><span class='line'><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CallVoidMethod</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;这里是实参&quot;</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L......................................."></a>
<h3>自定义简单控件显示锅炉压力</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">MyView</span> <span class="n">bar</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">static</span><span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">&quot;fill&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">bar</span> <span class="o">=</span> <span class="o">(</span><span class="n">MyView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">myView</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Thread</span><span class="o">(){</span>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span><span class='line'>                <span class="n">startFill</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">};</span>
</span><span class='line'>        <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="n">stopFill</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">(</span><span class="kt">int</span> <span class="n">p</span><span class="o">){</span>
</span><span class='line'>        <span class="n">bar</span><span class="o">.</span><span class="na">setCurr</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">startFill</span><span class="o">();</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">stopFill</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyView</span> <span class="kd">extends</span> <span class="n">View</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span> <span class="n">max</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">curr</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">MyView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">MyView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">MyView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDraw</span><span class="o">(</span><span class="n">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onDraw</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">max</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Paint</span> <span class="n">paint</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Paint</span><span class="o">();</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">curr</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="o">){</span>
</span><span class='line'>            <span class="n">paint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="k">new</span> <span class="nf">Color</span><span class="o">().</span><span class="na">GREEN</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span><span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">curr</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="o">){</span>
</span><span class='line'>            <span class="n">paint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="k">new</span> <span class="nf">Color</span><span class="o">().</span><span class="na">YELLOW</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">paint</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="k">new</span> <span class="nf">Color</span><span class="o">().</span><span class="na">RED</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">canvas</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">max</span><span class="o">-</span><span class="n">curr</span><span class="o">+</span><span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="n">max</span><span class="o">+</span><span class="mi">10</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCurr</span><span class="o">(</span><span class="kt">int</span> <span class="n">curr</span><span class="o">){</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">curr</span> <span class="o">=</span> <span class="n">curr</span><span class="o">;</span>
</span><span class='line'>        <span class="n">postInvalidate</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">jni</span><span class="o">.</span><span class="na">h</span><span class="o">&gt;</span>
</span><span class='line'><span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">time</span><span class="o">.</span><span class="na">h</span><span class="o">&gt;</span>
</span><span class='line'><span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">stdio</span><span class="o">.</span><span class="na">h</span><span class="o">&gt;</span>
</span><span class='line'><span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">stdlib</span><span class="o">.</span><span class="na">h</span><span class="o">&gt;</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Class:     com_example_fill_MainActivity</span>
</span><span class='line'><span class="cm"> * Method:    startFill</span>
</span><span class='line'><span class="cm"> * Signature: ()V</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kt">int</span> <span class="n">isRun</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span> <span class="nf">Java_com_example_fill_MainActivity_startFill</span>
</span><span class='line'>  <span class="o">(</span><span class="n">JNIEnv</span> <span class="o">*</span> <span class="n">env</span><span class="o">,</span> <span class="n">jobject</span> <span class="n">obj</span><span class="o">)</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="n">srand</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>    <span class="k">while</span><span class="o">(</span><span class="n">isRun</span><span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="n">jclass</span> <span class="n">clazz</span> <span class="o">=</span> <span class="o">(*</span><span class="n">env</span><span class="o">)-&gt;</span><span class="n">FindClass</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="s">&quot;com/example/fill/MainActivity&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">jmethodID</span> <span class="n">mid</span> <span class="o">=</span> <span class="o">(*</span><span class="n">env</span><span class="o">)-&gt;</span><span class="n">GetMethodID</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="n">clazz</span><span class="o">,</span> <span class="s">&quot;show&quot;</span><span class="o">,</span> <span class="s">&quot;(I)V&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">(*</span><span class="n">env</span><span class="o">)-&gt;</span><span class="n">CallVoidMethod</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="n">obj</span><span class="o">,</span> <span class="n">mid</span><span class="o">,</span> <span class="n">i</span><span class="o">++);</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">==</span><span class="mi">100</span><span class="o">?</span> <span class="mi">0</span><span class="o">:</span><span class="n">i</span><span class="o">;</span>
</span><span class='line'>        <span class="n">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Class:     com_example_fill_MainActivity</span>
</span><span class='line'><span class="cm"> * Method:    stopFill</span>
</span><span class='line'><span class="cm"> * Signature: ()V</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span> <span class="nf">Java_com_example_fill_MainActivity_stopFill</span>
</span><span class='line'><span class="o">(</span><span class="n">JNIEnv</span> <span class="o">*</span> <span class="n">env</span><span class="o">,</span> <span class="n">jobject</span> <span class="n">obj</span><span class="o">)</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="n">isRun</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L...C.........C.."></a>
<h3>把C改造为C++</h3>

<ol>
<li>把c文件后缀名换成cpp</li>
<li>Android.mk文件中的hello.c也要换成hello.cpp</li>
<li>c++使用的环境变量的结构体，访问了c使用的结构体的函数指针，函数名全部都是一样的，只是参数去掉了结构体的指针</li>
<li>在cpp文件中引用javah生成的头文件</li>
</ol>


<a name="L........................"></a>
<h2>获取地理位置信息</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LocationService</span> <span class="kd">extends</span> <span class="n">Service</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">CODE_LOCATION</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">LocationManager</span> <span class="n">locationManager</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">LocationListener</span> <span class="n">locationListener</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">locationManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">LocationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">LOCATION_SERVICE</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Criteria</span> <span class="n">criteria</span> <span class="o">=</span>  <span class="k">new</span> <span class="nf">Criteria</span><span class="o">();</span>
</span><span class='line'>        <span class="n">criteria</span><span class="o">.</span><span class="na">setCostAllowed</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span><span class="c1">//设置是否付费，比如使用3g网络</span>
</span><span class='line'>        <span class="n">criteria</span><span class="o">.</span><span class="na">setAccuracy</span><span class="o">(</span><span class="n">Criteria</span><span class="o">.</span><span class="na">ACCURACY_FINE</span><span class="o">);</span><span class="c1">//设置精确度</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">bestService</span> <span class="o">=</span> <span class="n">locationManager</span><span class="o">.</span><span class="na">getBestProvider</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">locationListener</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">LocationListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStatusChanged</span><span class="o">(</span><span class="n">String</span> <span class="n">provider</span><span class="o">,</span> <span class="kt">int</span> <span class="n">status</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProviderEnabled</span><span class="o">(</span><span class="n">String</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProviderDisabled</span><span class="o">(</span><span class="n">String</span> <span class="n">provider</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLocationChanged</span><span class="o">(</span><span class="n">Location</span> <span class="n">location</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="kt">double</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="na">getLongitude</span><span class="o">();</span>
</span><span class='line'>                <span class="kt">double</span> <span class="n">latitude</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="na">getLatitude</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Bundle</span><span class="o">();</span>
</span><span class='line'>                <span class="n">bundle</span><span class="o">.</span><span class="na">putDouble</span><span class="o">(</span><span class="s">&quot;longtitude&quot;</span><span class="o">,</span> <span class="n">longitude</span><span class="o">);</span>
</span><span class='line'>                <span class="n">bundle</span><span class="o">.</span><span class="na">putDouble</span><span class="o">(</span><span class="s">&quot;lativude&quot;</span><span class="o">,</span> <span class="n">latitude</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="na">obtain</span><span class="o">();</span>
</span><span class='line'>                <span class="n">msg</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
</span><span class='line'>                <span class="n">msg</span><span class="o">.</span><span class="na">what</span> <span class="o">=</span> <span class="n">CODE_LOCATION</span><span class="o">;</span>
</span><span class='line'>                <span class="n">SMSReceiver</span><span class="o">.</span><span class="na">handler</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">stopSelf</span><span class="o">();</span><span class="c1">//停止服务，省电</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">};</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">locationManager</span><span class="o">.</span><span class="na">requestLocationUpdates</span><span class="o">(</span><span class="n">bestService</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">locationListener</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">locationManager</span><span class="o">.</span><span class="na">removeUpdates</span><span class="o">(</span><span class="n">locationListener</span><span class="o">);</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L....................."></a>
<h2>锁屏，卸载应用</h2>

<ul>
<li><p>创建一个AdminReceiver，继承自DeviceAdminReceiver</p></li>
<li><p>在清单文件中声明</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;receiver</span>
</span><span class='line'>    <span class="na">android:name=</span><span class="s">&quot;.AdminReceiver&quot;</span>
</span><span class='line'>    <span class="na">android:description=</span><span class="s">&quot;@string/device_admin_desc&quot;</span>
</span><span class='line'>    <span class="na">android:label=</span><span class="s">&quot;手机安全卫士设备管理&quot;</span>
</span><span class='line'>    <span class="na">android:permission=</span><span class="s">&quot;android.permission.BIND_DEVICE_ADMIN&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta-data</span> <span class="na">android:name=</span><span class="s">&quot;android.app.device_admin&quot;</span>
</span><span class='line'>       <span class="na">android:resource=</span><span class="s">&quot;@xml/device_admin&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.app.action.DEVICE_ADMIN_ENABLED&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class='line'><span class="nt">&lt;/receiver&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>在res文件夹下创建文件夹xml，在xml中创建文件device_admin.xml</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;device-admin</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;uses-policies&gt;</span>
</span><span class='line'>        <span class="nt">&lt;limit-password</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;watch-login</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;reset-password</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;force-lock</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;wipe-data</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;expire-password</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;encrypted-storage</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;disable-camera</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;disable-keyguard-features</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/uses-policies&gt;</span>
</span><span class='line'><span class="nt">&lt;/device-admin&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>创建一个Activity</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">ComponentName</span> <span class="n">componentName</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">DevicePolicyManager</span> <span class="n">devicePolicyManager</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">active</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="c1">//激活设备管理器</span>
</span><span class='line'>        <span class="n">Intent</span> <span class="n">intent_dev</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">DevicePolicyManager</span><span class="o">.</span><span class="na">ACTION_ADD_DEVICE_ADMIN</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">componentName</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ComponentName</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">AdminReceiver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">intent_dev</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">DevicePolicyManager</span><span class="o">.</span><span class="na">EXTRA_DEVICE_ADMIN</span><span class="o">,</span> <span class="n">componentName</span><span class="o">);</span>
</span><span class='line'>        <span class="n">intent_dev</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">DevicePolicyManager</span><span class="o">.</span><span class="na">EXTRA_ADD_EXPLANATION</span><span class="o">,</span>
</span><span class='line'>                            <span class="s">&quot;激活手机安全卫士管理器，全面为您的手机保驾护航&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">startActivity</span><span class="o">(</span><span class="n">intent_dev</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">lock</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="n">devicePolicyManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">DevicePolicyManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">DEVICE_POLICY_SERVICE</span><span class="o">);</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">devicePolicyManager</span><span class="o">.</span><span class="na">isAdminActive</span><span class="o">(</span><span class="n">componentName</span><span class="o">)){</span>
</span><span class='line'>            <span class="n">devicePolicyManager</span><span class="o">.</span><span class="na">lockNow</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//重置密码</span>
</span><span class='line'>            <span class="n">devicePolicyManager</span><span class="o">.</span><span class="na">resetPassword</span><span class="o">(</span><span class="s">&quot;123456&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span><span class="c1">//flag表示禁止其它设备管理器再重置密码</span>
</span><span class='line'>        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
</span><span class='line'>            <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">&quot;log&quot;</span><span class="o">,</span> <span class="s">&quot;设备管理器未激活&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">uninstall</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">){</span>
</span><span class='line'>        <span class="c1">//取消激活，如果未取消激活，该应用将在用户手机上显示为不可卸载</span>
</span><span class='line'>        <span class="n">devicePolicyManager</span><span class="o">.</span><span class="na">removeActiveAdmin</span><span class="o">(</span><span class="n">componentName</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//卸载程序</span>
</span><span class='line'>        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_UNINSTALL_PACKAGE</span><span class="o">);</span>
</span><span class='line'>        <span class="n">intent</span><span class="o">.</span><span class="na">addCategory</span><span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">CATEGORY_DEFAULT</span><span class="o">);</span>
</span><span class='line'>        <span class="n">intent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;package:&quot;</span><span class="o">+</span><span class="n">getPackageName</span><span class="o">()));</span>
</span><span class='line'>        <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>






	
			<div style="height:50px;width:100%;"></div>
			
			    <div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>

			

			
			  <section>
			   <!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="/blog/2015/11/26/Android%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Android基础学习笔记" data-title="Android基础学习笔记" data-url="http://www.annpeter.cn/blog/2015/11/26/Android%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {short_name:"annpeter"};
    (function() {

        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
     })();
 </script>
 <!-- 多说公共JS代码 end -->

			  </section>
			 
		</div>



	
</div>

<div class="meta" id="leftSidebar" style="top:30px">
	<div class="date">




Nov 26th, 2015</div>
	<div class="tags">


	<a class='category' href='/blog/categories/android/'>android</a>


</div>
	
	<div style="height:30px;"></div>

	
	<aside class="sidebar thirds">
	  
	    <section> 
  <h1>分类目录</h1> 
  <ul id="categories"> 
    <li class='category'><a href='/blog/categories/android/'>android (5)</a></li>
<li class='category'><a href='/blog/categories/apos/'>apos (3)</a></li>
<li class='category'><a href='/blog/categories/arm/'>arm (17)</a></li>
<li class='category'><a href='/blog/categories/c-cpp/'>c-cpp (2)</a></li>
<li class='category'><a href='/blog/categories/mini2440/'>mini2440 (17)</a></li>
<li class='category'><a href='/blog/categories/os/'>os (7)</a></li>
<li class='category'><a href='/blog/categories/others/'>others (7)</a></li>
<li class='category'><a href='/blog/categories/server/'>server (11)</a></li>
 
  </ul> 
</section>
<section>
  <h1>最近博文</h1> 
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/12/IntelJIDE%E5%BF%AB%E6%8D%B7%E9%94%AE/index.html">IntelJIDE快捷键</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/09/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AD%A6%E4%B9%A0/index.html">正则表达式学习</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/01/Android%E5%8F%8D%E7%BC%96%E8%AF%91%EF%BC%8C%E6%90%BA%E5%B8%A6id%E9%87%8D%E7%AD%BE%E5%90%8D/index.html">Android反编译，携带id重签名</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/21/CentOS7%E5%AE%89%E8%A3%85Oracle12c/index.html">CentOS7安装Oracle12c</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/14/Apache%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85/index.html">Apache源码安装</a>
      </li>
    
  </ul>
</section>

	  
	</aside>
	

	
</div>

<!-- 用于避免文章太短，侧边栏太长 -->
<script type="text/javascript">
	(function($){
		var heightSideBar = $('#leftSidebar').height()+parseInt($('#leftSidebar').css('top'));
		var heightArticle = $('#rightArticle').height()+277; //其中277为多说的高度

		if(heightArticle < heightSideBar)
		{
			$('#rightArticle').height(heightSideBar);	
		}
	})(jQuery);
</script>


</article>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    AnnPeter


</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>